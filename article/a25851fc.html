<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":"ture","show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":"ture","mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":"ture","trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言&amp;emsp;&amp;emsp;之前学的springboot笔记2，放上来方便查看">
<meta property="og:type" content="article">
<meta property="og:title" content="springboot学习笔记2">
<meta property="og:url" content="http://example.com/article/a25851fc.html">
<meta property="og:site_name" content="无名小站">
<meta property="og:description" content="前言&amp;emsp;&amp;emsp;之前学的springboot笔记2，放上来方便查看">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210714124006860.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210714124849592.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210714181616569.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/1603181171918-b8acfb93-4914-4208-9943-b37610e93864.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210715185208518.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210715185526781.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/1605230907471-b0ed34bc-6782-40e7-84b7-615726312f01.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210720183500471.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210727180518664.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/1606884394162-ac7f2d8e-7abb-44df-9998-fb0f2705f238.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210728123104731.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210728154004054.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210728160953697.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210728161146945.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210728165426782.png">
<meta property="og:image" content="http://example.com/SpringBoot-2-02.assets/image-20210728170239632.png">
<meta property="article:published_time" content="2022-04-17T07:14:33.000Z">
<meta property="article:modified_time" content="2022-04-17T07:22:48.925Z">
<meta property="article:author" content="Jie">
<meta property="article:tag" content="springboot">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/SpringBoot-2-02.assets/image-20210714124006860.png">

<link rel="canonical" href="http://example.com/article/a25851fc.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>springboot学习笔记2 | 无名小站</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="无名小站" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">无名小站</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/article/a25851fc.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="Jie">
      <meta itemprop="description" content="以后这样的事还多着呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无名小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          springboot学习笔记2
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-04-17 15:14:33 / 修改时间：15:22:48" itemprop="dateCreated datePublished" datetime="2022-04-17T15:14:33+08:00">2022-04-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

         
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
         
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">评论数：</span>
    
    <a title="valine" href="/article/a25851fc.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/article/a25851fc.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>61k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>55 分钟</span>
            </span>

          
            <span id="/article/a25851fc.html" class="post-meta-item leancloud_visitors" data-flag-title="springboot学习笔记2" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>&emsp;&emsp;之前学的springboot笔记2，放上来方便查看</p>
<span id="more"></span>
<h2 id="1-配置文件"><a href="#1-配置文件" class="headerlink" title="1.配置文件"></a>1.配置文件</h2><h3 id="1-1-properties"><a href="#1-1-properties" class="headerlink" title="1.1 properties"></a>1.1 properties</h3><p>当配置文件中的中文乱码时，可以在setting里面进行修改,IDEA中设置 <code>File Encodings</code></p>
<p>修改之后还是不失效，可以把配置文件删了，再重新创一个</p>
<h3 id="1-2-yaml"><a href="#1-2-yaml" class="headerlink" title="1.2 yaml"></a>1.2 yaml</h3><p>application.yml也可以用来当作配置文件使用</p>
<p><strong>配置文件在同一位置同时具有<code>.properties</code>和<code>.yml</code>格式，<code>.properties</code>则优先。</strong></p>
<p>application.properties和application.yml都会生效</p>
<p>基本语法如下：</p>
<ul>
<li><p>key: value；<strong>kv之间有空格</strong></p>
</li>
<li><p>大小写敏感</p>
</li>
<li><p><strong>使用缩进表示层级关系</strong></p>
</li>
<li><p>缩进不允许使用tab，只允许空格，idea会自动转换</p>
</li>
<li><p>缩进的空格数不重要，只要相同层级的元素左对齐即可</p>
</li>
<li><p>‘#’表示注释</p>
</li>
<li><p>字符串无需加引号，如果要加，’’与””表示字符串内容 会被 转义/不转义</p>
<ul>
<li>双引号不会转义</li>
<li>单引号会转义</li>
</ul>
</li>
</ul>
<h3 id="1-3-配置提示"><a href="#1-3-配置提示" class="headerlink" title="1.3 配置提示"></a>1.3 配置提示</h3><p>直接在yaml文件中编写配置，没有提示，可以加入相应的依赖来实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                      <span class="comment">&lt;!--打包时忽略自定义类配置提示工具--&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="2-Web开发"><a href="#2-Web开发" class="headerlink" title="2.Web开发"></a>2.Web开发</h2><h3 id="2-1-SpringMvc-自动配置"><a href="#2-1-SpringMvc-自动配置" class="headerlink" title="2.1 SpringMvc 自动配置"></a>2.1 SpringMvc 自动配置</h3><p>详见官网：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications">https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications</a></p>
<p>（下面为谷歌翻译原文档）</p>
<p>Spring Boot 为 Spring MVC 提供了自动配置，适用于大多数应用程序。</p>
<p>自动配置在 Spring 的默认值之上添加了以下功能：</p>
<ul>
<li>包括<code>ContentNegotiatingViewResolver</code>和<code>BeanNameViewResolver</code>beans。</li>
<li>支持提供静态资源，包括对 WebJars 的支持（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.spring-mvc.static-content">本文档稍后介绍</a>）。</li>
<li>自动注册<code>Converter</code>，<code>GenericConverter</code>和<code>Formatter</code>beans。</li>
<li>支持<code>HttpMessageConverters</code>（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.spring-mvc.message-converters">在本文档后面介绍</a>）。</li>
<li><code>MessageCodesResolver</code>的自动注册（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.spring-mvc.message-codes">在本文档后面介绍</a>）。</li>
<li>静态<code>index.html</code>支持。</li>
<li><code>ConfigurableWebBindingInitializer</code>bean 的自动使用（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.spring-mvc.binding-initializer">本文档稍后介绍</a>）。</li>
</ul>
<p>如果您想保留那些 Spring Boot MVC 自定义并进行更多<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.8/reference/html/web.html#mvc">MVC 自定义</a>（拦截器、格式化程序、视图控制器和其他功能），您可以添加自己<code>@Configuration</code>的类型类，<code>WebMvcConfigurer</code>但<strong>不添加</strong> <code>@EnableWebMvc</code>.</p>
<p>如果你想提供的定制情况<code>RequestMappingHandlerMapping</code>，<code>RequestMappingHandlerAdapter</code>或者<code>ExceptionHandlerExceptionResolver</code>，仍然保持弹簧引导MVC自定义，你可以声明类型的bean<code>WebMvcRegistrations</code>，并用它来提供这些组件的定制实例。</p>
<p>如果你想利用Spring MVC中的完全控制，你可以添加自己的<code>@Configuration</code>注解为<code>@EnableWebMvc</code>，或者添加自己的<code>@Configuration</code>-annotated<code>DelegatingWebMvcConfiguration</code>中的Javadoc中所述<code>@EnableWebMvc</code>。</p>
<p>需要SpringMVC的什么功能。编写一个入口给容器中添加一个  WebMvcConfigurer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、WebMvcConfigurer定制化SpringMVC的功能</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 自定义内容协商策略</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> configurer</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//Map&lt;String, MediaType&gt; mediaTypes</span></span><br><span class="line">                Map&lt;String, MediaType&gt; mediaTypes = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">                mediaTypes.put(<span class="string">&quot;json&quot;</span>,MediaType.APPLICATION_JSON);</span><br><span class="line">                mediaTypes.put(<span class="string">&quot;xml&quot;</span>,MediaType.APPLICATION_XML);</span><br><span class="line">                mediaTypes.put(<span class="string">&quot;gg&quot;</span>,MediaType.parseMediaType(<span class="string">&quot;application/x-guigu&quot;</span>));</span><br><span class="line">                <span class="comment">//指定支持解析哪些参数对应的哪些媒体类型</span></span><br><span class="line">                ParameterContentNegotiationStrategy parameterStrategy = <span class="keyword">new</span> ParameterContentNegotiationStrategy(mediaTypes);</span><br><span class="line"><span class="comment">//                parameterStrategy.setParameterName(&quot;ff&quot;);</span></span><br><span class="line"></span><br><span class="line">                HeaderContentNegotiationStrategy headeStrategy = <span class="keyword">new</span> HeaderContentNegotiationStrategy();</span><br><span class="line"></span><br><span class="line">                configurer.strategies(Arrays.asList(parameterStrategy,headeStrategy));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">                converters.add(<span class="keyword">new</span> GuiguMessageConverter());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>&#123;</span><br><span class="line">                UrlPathHelper urlPathHelper = <span class="keyword">new</span> UrlPathHelper();</span><br><span class="line">                <span class="comment">// 不移除；后面的内容。矩阵变量功能就可以生效</span></span><br><span class="line">                urlPathHelper.setRemoveSemicolonContent(<span class="keyword">false</span>);</span><br><span class="line">                configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-2-简单功能分析"><a href="#2-2-简单功能分析" class="headerlink" title="2.2 简单功能分析"></a>2.2 简单功能分析</h3><h4 id="1-静态资源的访问"><a href="#1-静态资源的访问" class="headerlink" title="1. 静态资源的访问"></a>1. 静态资源的访问</h4><ul>
<li><p>默认情况下，Spring Boot 可以访问名为<code>/static</code>（或<code>/public</code>或<code>/resources</code>或<code>/META-INF/resources</code>）下的静态资源</p>
</li>
<li><p>访问路径：localhost:8080/静态资源文件名</p>
</li>
<li><p>原理： 静态映射/**</p>
<p>请求进来，先去找Controller看能不能处理。不能处理的所有请求又都交给静态资源处理器。静态资源也找不到则响应404页面</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment">#访问路径加resources前缀</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">&quot;/resources/**&quot;</span></span><br><span class="line">  <span class="comment">#默认静态资源文件夹改变</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">static-locations:</span> [ <span class="string">classpath:/haha/</span> ]</span><br></pre></td></tr></table></figure>

<p>​        注意点：程序重新启动记得在maven生存周期里面，clean</p>
<p>​                <img src="/SpringBoot-2-02.assets/image-20210714124006860.png" alt="image-20210714124006860"></p>
<h4 id="2-Webjars"><a href="#2-Webjars" class="headerlink" title="2. Webjars"></a>2. Webjars</h4><p><a target="_blank" rel="noopener" href="https://www.webjars.org/">https://www.webjars.org/</a></p>
<ul>
<li>先导入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>原理，访问META-INF/resources下面的路径</p>
<p><img src="/SpringBoot-2-02.assets/image-20210714124849592.png" alt="image-20210714124849592"></p>
</li>
</ul>
<p>访问地址：<a target="_blank" rel="noopener" href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js">http://localhost:8080/webjars/<strong>jquery/3.6.0/jquery.js</strong></a>   后面地址要按照依赖里面的包路径</p>
<h4 id="3-欢迎页与小图标"><a href="#3-欢迎页与小图标" class="headerlink" title="3. 欢迎页与小图标"></a>3. 欢迎页与小图标</h4><ul>
<li>SpringBoot支持从静态资源直接访问欢迎页，或者从Controller层获取</li>
<li>将index.html文件放在静态资源目录下面即可<ul>
<li>可以配置静态资源路径</li>
<li>但是不可以配置静态资源的访问前缀。否则导致 index.html不能被默认访问</li>
</ul>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="comment">#  mvc:</span></span><br><span class="line"><span class="comment">#    static-path-pattern: /res/**   这个会导致welcome page功能失效</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">static-locations:</span> [<span class="string">classpath:/haha/</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>小图标favicon.ico文件放在静态资源目录下面即可</li>
<li>与欢迎页类似</li>
<li>最新springboot版本已经移除对小图标直接访问的介绍</li>
</ul>
<h4 id="4-静态资源源码分析"><a href="#4-静态资源源码分析" class="headerlink" title="4. 静态资源源码分析"></a>4. 静态资源源码分析</h4><ul>
<li><p>SpringBoot启动默认加载  xxxAutoConfiguration 类（自动配置类）</p>
</li>
<li><p>SpringMVC功能的自动配置类 WebMvcAutoConfiguration，生效</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="comment">#  mvc:</span></span><br><span class="line"><span class="comment">#    static-path-pattern: /res/**</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">add-mappings:</span> <span class="literal">false</span>   <span class="string">禁用所有静态资源规则</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-3-请求参数处理"><a href="#2-3-请求参数处理" class="headerlink" title="2.3 请求参数处理"></a>2.3 请求参数处理</h3><h4 id="1-Rest风格"><a href="#1-Rest风格" class="headerlink" title="1. Rest风格"></a>1. Rest风格</h4><ul>
<li><p><em>以前：</em><em>/getUser</em>  <em>获取用户</em>    <em>/deleteUser</em> <em>删除用户</em>   <em>/editUser</em>  <em>修改用户</em>      <em>/saveUser</em> <em>保存用户</em></p>
</li>
<li><p><em>现在： /user</em>    *GET-*<em>获取用户</em>    *DELETE-*<em>删除用户</em>     *PUT-*<em>修改用户</em>      *POST-*<em>保存用户</em></p>
</li>
<li><p>使用如下：</p>
<ul>
<li><p>~~~Java<br>@RestController<br>public class HelloController {</p>
<pre><code>//    @RequestMapping(value = &quot;/user&quot;,method = RequestMethod.GET)
@GetMapping(&quot;/user&quot;)
public String getUser()&#123;

    return &quot;GET-张三&quot;;
&#125;

//    @RequestMapping(value = &quot;/user&quot;,method = RequestMethod.POST)
@PostMapping(&quot;/user&quot;)
public String saveUser()&#123;
    return &quot;POST-张三&quot;;
&#125;


//    @RequestMapping(value = &quot;/user&quot;,method = RequestMethod.PUT)
@PutMapping(&quot;/user&quot;)
public String putUser()&#123;

    return &quot;PUT-张三&quot;;
&#125;

@DeleteMapping(&quot;/user&quot;)
</code></pre>
<p>//    @RequestMapping(value = “/user”,method = RequestMethod.DELETE)</p>
<pre><code>public String deleteUser()&#123;
    return &quot;DELETE-张三&quot;;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ~~~html</span><br><span class="line">  测试REST风格；</span><br><span class="line">  &lt;form action=&quot;/user&quot; method=&quot;get&quot;&gt;</span><br><span class="line">      &lt;input value=&quot;REST-GET 提交&quot; type=&quot;submit&quot;/&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;form action=&quot;/user&quot; method=&quot;post&quot;&gt;</span><br><span class="line">      &lt;input value=&quot;REST-POST 提交&quot; type=&quot;submit&quot;/&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;form action=&quot;/user&quot; method=&quot;post&quot;&gt;</span><br><span class="line">      &lt;input name=&quot;_method&quot; type=&quot;hidden&quot; value=&quot;delete&quot;/&gt;</span><br><span class="line">      &lt;input name=&quot;_m&quot; type=&quot;hidden&quot; value=&quot;delete&quot;/&gt;</span><br><span class="line">      &lt;input value=&quot;REST-DELETE 提交&quot; type=&quot;submit&quot;/&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;form action=&quot;/user&quot; method=&quot;post&quot;&gt;</span><br><span class="line">      &lt;input name=&quot;_method&quot; type=&quot;hidden&quot; value=&quot;PUT&quot;/&gt;</span><br><span class="line">      &lt;input value=&quot;REST-PUT 提交&quot; type=&quot;submit&quot;/&gt;</span><br><span class="line">  &lt;/form&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>get和post 可以直接识别，其他的不行</p>
</li>
<li><p>其他的需要写成post，加上<input name="_method" type="hidden" value="PUT"/>，源码如下</p>
<p><img src="/SpringBoot-2-02.assets/image-20210714181616569.png" alt="image-20210714181616569"></p>
</li>
</ul>
</li>
<li><p>使用Rest风格需要手动开启</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">hiddenmethod:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment">#开启页面表单的Rest功能，默认是false</span></span><br></pre></td></tr></table></figure></li>
<li><p>Rest原理（<strong>表单提交</strong>要使用REST的时候）</p>
<ul>
<li>表单提交会带上**_method=PUT**</li>
<li><strong>请求过来被</strong>HiddenHttpMethodFilter拦截<ul>
<li>请求是否正常，并且是POST</li>
<li>获取到**_method**的值。</li>
<li>兼容以下请求；<strong>PUT</strong>.<strong>DELETE</strong>.<strong>PATCH</strong></li>
<li><strong>原生request（post），包装模式requesWrapper重写了getMethod方法，返回的是传入的值。</strong></li>
<li><strong>过滤器链放行的时候用wrapper。以后的方法调用getMethod是调用</strong>requesWrapper的。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Rest使用客户端工具，</strong></p>
<ul>
<li>如PostMan直接发送Put、delete等方式请求，无需Filter。</li>
</ul>
</li>
<li><p>拓展，修改默认的_method</p>
<ul>
<li>自己重写配置类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> /*<span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span>*/ </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HiddenHttpMethodFilter <span class="title">hiddenHttpMethodFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HiddenHttpMethodFilter methodFilter = <span class="keyword">new</span> HiddenHttpMethodFilter();</span><br><span class="line">        methodFilter.setMethodParam(<span class="string">&quot;_m&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> methodFilter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-请求映射原理"><a href="#2-请求映射原理" class="headerlink" title="2. 请求映射原理"></a>2. 请求映射原理</h4><p>SpringMVC功能分析都从 org.springframework.web.servlet.DispatcherServlet–&gt;doDispatch（）</p>
<p><img src="/SpringBoot-2-02.assets/1603181171918-b8acfb93-4914-4208-9943-b37610e93864.png" alt="image.png"></p>
<h4 id="3-常用的注解"><a href="#3-常用的注解" class="headerlink" title="3. 常用的注解"></a>3. 常用的注解</h4><ul>
<li><p>@PathVariable 路径变量    @PathVariable(“id”) Integer id,</p>
<ul>
<li>路径变量和请求参数的不同</li>
<li>路径变量：/{id}</li>
<li>请求参数：?age=18</li>
</ul>
</li>
<li><p>@RequestHeader 请求头 @RequestHeader(“User-Agent”) String userAgent</p>
<ul>
<li><img src="/SpringBoot-2-02.assets/image-20210715185208518.png" alt="image-20210715185208518"></li>
</ul>
</li>
<li><p>@RequestParam 请求参数 @RequestParam(“age”) Integer age,</p>
</li>
<li><p>@CookieValue 获取cookie值  @CookieValue(“<strong>Pycharm-40937f47”</strong>) Cookie cookie</p>
<ul>
<li><img src="/SpringBoot-2-02.assets/image-20210715185526781.png" alt="image-20210715185526781"></li>
</ul>
</li>
<li><p>@RequestBody 获取请求体[必须为POST]  @RequestBody String content</p>
</li>
<li><p>上述五个注解，除了可以单独获取其中的参数，也可以使用**Map&lt;String,String&gt;**方式来获取整个map</p>
</li>
</ul>
<ul>
<li><p>@RequestAttribute    获取request域属性 @RequestAttribute(value = “msg”,required = false) String msg</p>
<ul>
<li>required的取值如下：</li>
<li>Both the MVC namespace and the MVC Java configuration keep this flag set to <code>false</code>, to maintain backwards compatibility. However, for new applications, we recommend setting it to <code>true</code>.</li>
<li>MVC 命名空间和 MVC Java 配置都将此标志设置为<code>false</code>，以保持向后兼容性。但是，对于新应用程序，我们建议将其设置为<code>true</code>.</li>
</ul>
</li>
<li><p>@MatrixVariable  矩阵变量  @MatrixVariable(“low”) Integer low</p>
<ul>
<li><p>语法： 请求路径：/cars/sell;low=34;brand=byd,audi,yd</p>
</li>
<li><p>SpringBoot默认是禁用了矩阵变量的功能</p>
</li>
<li><p>手动开启：原理。</p>
<ul>
<li><p>对于路径的处理。UrlPathHelper进行解析。</p>
</li>
<li><p>removeSemicolonContent（移除分号内容）支持矩阵变量的</p>
</li>
<li><p>~~~java<br>@Override</p>
<pre><code>        public void configurePathMatch(PathMatchConfigurer configurer) &#123;
            UrlPathHelper urlPathHelper = new UrlPathHelper();
            // 不移除；后面的内容。矩阵变量功能就可以生效
            urlPathHelper.setRemoveSemicolonContent(false);
            configurer.setUrlPathHelper(urlPathHelper);
        &#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 矩阵变量必须有url路径变量才能被解析</span><br><span class="line"></span><br><span class="line">- ~~~Java</span><br><span class="line">  @RestController</span><br><span class="line">  public class ParameterTestController &#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      //  car/2/owner/zhangsan</span><br><span class="line">      @GetMapping(&quot;/car/&#123;id&#125;/owner/&#123;username&#125;&quot;)</span><br><span class="line">      public Map&lt;String,Object&gt; getCar(@PathVariable(&quot;id&quot;) Integer id,</span><br><span class="line">                                       @PathVariable(&quot;username&quot;) String name,</span><br><span class="line">                                       @PathVariable Map&lt;String,String&gt; pv,</span><br><span class="line">                                       @RequestHeader(&quot;User-Agent&quot;) String userAgent,</span><br><span class="line">                                       @RequestHeader Map&lt;String,String&gt; header,</span><br><span class="line">                                       @RequestParam(&quot;age&quot;) Integer age,</span><br><span class="line">                                       @RequestParam(&quot;inters&quot;) List&lt;String&gt; inters,</span><br><span class="line">                                       @RequestParam Map&lt;String,String&gt; params,</span><br><span class="line">                                       @CookieValue(&quot;Pycharm-40937f47&quot;) String _ga,</span><br><span class="line">                                       @CookieValue(&quot;Pycharm-40937f47&quot;) Cookie cookie)&#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">          Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  //        map.put(&quot;id&quot;,id);</span><br><span class="line">  //        map.put(&quot;name&quot;,name);</span><br><span class="line">  //        map.put(&quot;pv&quot;,pv);</span><br><span class="line">          map.put(&quot;userAgent&quot;,userAgent);</span><br><span class="line">          map.put(&quot;headers&quot;,header);</span><br><span class="line">          map.put(&quot;age&quot;,age);</span><br><span class="line">          map.put(&quot;inters&quot;,inters);</span><br><span class="line">          map.put(&quot;params&quot;,params);</span><br><span class="line">          map.put(&quot;_ga&quot;,_ga);</span><br><span class="line">          System.out.println(cookie.getName()+&quot;===&gt;&quot;+cookie.getValue());</span><br><span class="line">          return map;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      @PostMapping(&quot;/save&quot;)</span><br><span class="line">      public Map postMethod(@RequestBody String content)&#123;</span><br><span class="line">          Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">          map.put(&quot;content&quot;,content);</span><br><span class="line">          return map;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      //1、语法： 请求路径：/cars/sell;low=34;brand=byd,audi,yd</span><br><span class="line">      //2、SpringBoot默认是禁用了矩阵变量的功能</span><br><span class="line">      //      手动开启：原理。对于路径的处理。UrlPathHelper进行解析。</span><br><span class="line">      //              removeSemicolonContent（移除分号内容）支持矩阵变量的</span><br><span class="line">      //3、矩阵变量必须有url路径变量才能被解析</span><br><span class="line">      @GetMapping(&quot;/cars/&#123;path&#125;&quot;)</span><br><span class="line">      public Map carsSell(@MatrixVariable(&quot;low&quot;) Integer low,</span><br><span class="line">                          @MatrixVariable(&quot;brand&quot;) List&lt;String&gt; brand,</span><br><span class="line">                          @PathVariable(&quot;path&quot;) String path)&#123;</span><br><span class="line">          Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">          map.put(&quot;low&quot;,low);</span><br><span class="line">          map.put(&quot;brand&quot;,brand);</span><br><span class="line">          map.put(&quot;path&quot;,path);</span><br><span class="line">          return map;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      // /boss/1;age=20/2;age=10</span><br><span class="line">  </span><br><span class="line">      @GetMapping(&quot;/boss/&#123;bossId&#125;/&#123;empId&#125;&quot;)</span><br><span class="line">      public Map boss(@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;bossId&quot;) Integer bossAge,</span><br><span class="line">                      @MatrixVariable(value = &quot;age&quot;,pathVar = &quot;empId&quot;) Integer empAge)&#123;</span><br><span class="line">          Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">          map.put(&quot;bossAge&quot;,bossAge);</span><br><span class="line">          map.put(&quot;empAge&quot;,empAge);</span><br><span class="line">          return map;</span><br><span class="line">  </span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-Servlet-API"><a href="#4-Servlet-API" class="headerlink" title="4. Servlet API"></a>4. Servlet API</h4><p>WebRequest、ServletRequest、MultipartRequest、 HttpSession、javax.servlet.http.PushBuilder、Principal、InputStream、Reader、HttpMethod、Locale、TimeZone、ZoneId</p>
<p><strong>ServletRequestMethodArgumentResolver  以上的部分参数</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter parameter)</span> </span>&#123;</span><br><span class="line">		Class&lt;?&gt; paramType = parameter.getParameterType();</span><br><span class="line">		<span class="keyword">return</span> (WebRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">				ServletRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">				MultipartRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">				HttpSession.class.isAssignableFrom(paramType) ||</span><br><span class="line">				(pushBuilder != <span class="keyword">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType)) ||</span><br><span class="line">				Principal.class.isAssignableFrom(paramType) ||</span><br><span class="line">				InputStream.class.isAssignableFrom(paramType) ||</span><br><span class="line">				Reader.class.isAssignableFrom(paramType) ||</span><br><span class="line">				HttpMethod.class == paramType ||</span><br><span class="line">				Locale.class == paramType ||</span><br><span class="line">				TimeZone.class == paramType ||</span><br><span class="line">				ZoneId.class == paramType);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-复杂参数"><a href="#5-复杂参数" class="headerlink" title="5. 复杂参数"></a>5. 复杂参数</h4><p><strong>Map</strong>、<strong>Model（map、model里面的数据会被放在request的请求域  request.setAttribute）、</strong>Errors/BindingResult、<strong>RedirectAttributes（ 重定向携带数据）</strong>、<strong>ServletResponse（response）</strong>、SessionStatus、UriComponentsBuilder、ServletUriComponentsBuilder</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Object&gt; map,  Model model, HttpServletRequest request 都是可以给request域中放数据，</span><br><span class="line">request.getAttribute();</span><br></pre></td></tr></table></figure>

<h4 id="6-pojo封装"><a href="#6-pojo封装" class="headerlink" title="6. pojo封装"></a>6. pojo封装</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据绑定：页面提交的请求数据（GET、POST）都可以和对象属性进行绑定</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> person</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/saveuser&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">saveuser</span><span class="params">(Person person)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> person;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以自定义类型参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry registry)</span> </span>&#123;</span><br><span class="line">                registry.addConverter(<span class="keyword">new</span> Converter&lt;String, Pet&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Pet <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// 啊猫,3</span></span><br><span class="line">                        <span class="keyword">if</span>(!StringUtils.isEmpty(source))&#123;</span><br><span class="line">                            Pet pet = <span class="keyword">new</span> Pet();</span><br><span class="line">                            String[] split = source.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                            pet.setName(split[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">//                            pet.setAge(Integer.parseInt(split[1]));</span></span><br><span class="line">                            pet.setAge(split[<span class="number">1</span>]);</span><br><span class="line">                            <span class="keyword">return</span> pet;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-4-数据响应"><a href="#2-4-数据响应" class="headerlink" title="2.4 数据响应"></a>2.4 数据响应</h3><h4 id="1-响应JSON数据"><a href="#1-响应JSON数据" class="headerlink" title="1. 响应JSON数据"></a>1. 响应JSON数据</h4><ul>
<li>主要通过jackson.jar+@ResponseBody</li>
<li>spring-boot-starter-web场景自动引入了json场景</li>
</ul>
<h4 id="2-springmvc支持响应的数据类型"><a href="#2-springmvc支持响应的数据类型" class="headerlink" title="2. springmvc支持响应的数据类型"></a>2. springmvc支持响应的数据类型</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ModelAndView</span><br><span class="line">Model</span><br><span class="line">View</span><br><span class="line">ResponseEntity </span><br><span class="line">ResponseBodyEmitter</span><br><span class="line">StreamingResponseBody</span><br><span class="line">HttpEntity</span><br><span class="line">HttpHeaders</span><br><span class="line">Callable</span><br><span class="line">DeferredResult</span><br><span class="line">ListenableFuture</span><br><span class="line">CompletionStage</span><br><span class="line">WebAsyncTask</span><br><span class="line">有 <span class="meta">@ModelAttribute</span> 且为对象类型的</span><br><span class="line"><span class="meta">@ResponseBody</span> 注解 ---&gt; RequestResponseBodyMethodProcessor；</span><br></pre></td></tr></table></figure>



<h3 id="2-5-内容协商"><a href="#2-5-内容协商" class="headerlink" title="2.5 内容协商"></a>2.5 内容协商</h3><p>根据客户端接收能力不同，返回不同媒体类型的数据。</p>
<ol>
<li><p>首先导入相应依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>开启浏览器参数方式内容协商功能</p>
<p>为了方便内容协商，开启基于请求参数的内容协商功能。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">mvc:</span></span><br><span class="line">    	<span class="attr">contentnegotiation:</span></span><br><span class="line">      		<span class="attr">favor-parameter:</span> <span class="literal">true</span>  <span class="comment">#开启请求参数内容协商模式</span></span><br></pre></td></tr></table></figure>

<p>发送请求：<a target="_blank" rel="noopener" href="http://localhost:8080/test/person?format=json">http://localhost:8080/test/person?format=json</a></p>
<p>​                   <a target="_blank" rel="noopener" href="http://localhost:8080/test/person?format=xml">http://localhost:8080/test/person?format=xml</a></p>
</li>
<li><p>内容协商分为基于请求头和基于请求参数两种</p>
<p><img src="/SpringBoot-2-02.assets/1605230907471-b0ed34bc-6782-40e7-84b7-615726312f01.png" alt="image.png"></p>
</li>
<li><p>自定义MessageConverter</p>
<ul>
<li><p>~~~java<br>/**</p>
<pre><code>         * 自定义内容协商策略
         * @param configurer
         */
        @Override
        public void configureContentNegotiation(ContentNegotiationConfigurer configurer) &#123;
            //Map&lt;String, MediaType&gt; mediaTypes
            Map&lt;String, MediaType&gt; mediaTypes = new HashMap&lt;&gt;();
            mediaTypes.put(&quot;json&quot;,MediaType.APPLICATION_JSON);
            mediaTypes.put(&quot;xml&quot;,MediaType.APPLICATION_XML);
            mediaTypes.put(&quot;gg&quot;,MediaType.parseMediaType(&quot;application/x-guigu&quot;));
            //指定支持解析哪些参数对应的哪些媒体类型
            ParameterContentNegotiationStrategy parameterStrategy = new ParameterContentNegotiationStrategy(mediaTypes);
</code></pre>
<p>//                parameterStrategy.setParameterName(“ff”);</p>
<pre><code>            //保证之前请求头的方式不失效
            HeaderContentNegotiationStrategy headeStrategy = new HeaderContentNegotiationStrategy();

            configurer.strategies(Arrays.asList(parameterStrategy,headeStrategy));
        &#125;

        @Override
        public void extendMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;
            converters.add(new GuiguMessageConverter());
        &#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ~~~java</span><br><span class="line">  /**</span><br><span class="line">   * 自定义的Converter</span><br><span class="line">   */</span><br><span class="line">  public class GuiguMessageConverter implements HttpMessageConverter&lt;Person&gt; &#123;</span><br><span class="line">  </span><br><span class="line">      @Override</span><br><span class="line">      public boolean canRead(Class&lt;?&gt; clazz, MediaType mediaType) &#123;</span><br><span class="line">          return false;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      @Override</span><br><span class="line">      public boolean canWrite(Class&lt;?&gt; clazz, MediaType mediaType) &#123;</span><br><span class="line">          return clazz.isAssignableFrom(Person.class);</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      /**</span><br><span class="line">       * 服务器要统计所有MessageConverter都能写出哪些内容类型</span><br><span class="line">       *</span><br><span class="line">       * application/x-guigu</span><br><span class="line">       * @return</span><br><span class="line">       */</span><br><span class="line">      @Override</span><br><span class="line">      public List&lt;MediaType&gt; getSupportedMediaTypes() &#123;</span><br><span class="line">          return MediaType.parseMediaTypes(&quot;application/x-guigu&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      @Override</span><br><span class="line">      public Person read(Class&lt;? extends Person&gt; clazz, HttpInputMessage inputMessage) throws IOException, HttpMessageNotReadableException &#123;</span><br><span class="line">          return null;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      @Override</span><br><span class="line">      public void write(Person person, MediaType contentType, HttpOutputMessage outputMessage) throws IOException, HttpMessageNotWritableException &#123;</span><br><span class="line">          //自定义协议数据的写出</span><br><span class="line">          String data = person.getUserName()+&quot;;&quot;+person.getAge()+&quot;;&quot;+person.getBirth();</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">          //写出去</span><br><span class="line">          OutputStream body = outputMessage.getBody();</span><br><span class="line">          body.write(data.getBytes());</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>有可能我们添加的自定义的功能会覆盖默认很多功能，导致一些默认的功能失效。</strong>比如上面添加自定义的请求参数协议时，请求头方式失效。</p>
<p><strong>上述功能除了我们完全自定义外？SpringBoot有没有为我们提供基于配置文件的快速修改媒体类型功能？怎么配置呢？【提示：参照SpringBoot官方文档web开发内容协商章节】</strong></p>
</li>
</ul>
</li>
</ol>
<h3 id="2-6-视图解析"><a href="#2-6-视图解析" class="headerlink" title="2.6 视图解析"></a>2.6 视图解析</h3><ul>
<li>视图解析流程</li>
</ul>
<h3 id="2-7-模板引擎-Thymeleaf"><a href="#2-7-模板引擎-Thymeleaf" class="headerlink" title="2.7 模板引擎-Thymeleaf"></a>2.7 模板引擎-Thymeleaf</h3><h4 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h4><p>springboot不支持jsp页面（可通过额外配置），支持模板引擎thymeleaf。推荐前后端分离开发。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/">https://www.thymeleaf.org/</a></p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html</a></p>
<h4 id="2-基本使用"><a href="#2-基本使用" class="headerlink" title="2. 基本使用"></a>2. 基本使用</h4><ul>
<li><p>引入相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>已经自动配置好了thymeleaf</p>
<ul>
<li><p>1、所有thymeleaf的配置值都在 ThymeleafProperties</p>
</li>
<li><p>2、配置好了 <strong>SpringTemplateEngine</strong> </p>
</li>
<li><p><strong>3、配好了</strong> <strong>ThymeleafViewResolver</strong> </p>
</li>
<li><p>4、我们只需要直接开发页面</p>
</li>
<li><p>~~~java</p>
<pre><code>private String prefix = &quot;classpath:/templates/&quot;;
private String suffix = &quot;.html&quot;;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 编写html文件，记得加上  xmlns:th=&quot;http://www.thymeleaf.org&quot;</span><br><span class="line"></span><br><span class="line">  ~~~html</span><br><span class="line">  &lt;!DOCTYPE html&gt;</span><br><span class="line">  &lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">      &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">      &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;h1 th:text=&quot;$&#123;msg&#125;&quot;&gt;哈哈&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;</span><br><span class="line">      &lt;a href=&quot;www.atguigu.com&quot; th:href=&quot;$&#123;link&#125;&quot;&gt;去百度&lt;/a&gt;  &lt;br/&gt;</span><br><span class="line">      &lt;a href=&quot;www.atguigu.com&quot; th:href=&quot;@&#123;link&#125;&quot;&gt;去百度2&lt;/a&gt;</span><br><span class="line">  &lt;/h2&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">  &lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>编写controller层</p>
</li>
<li><p>注：可以在配置文件给所有路径加上前缀</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#给页面路径加前缀</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/study</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-后台管理系统练习"><a href="#3-后台管理系统练习" class="headerlink" title="3. 后台管理系统练习"></a>3. 后台管理系统练习</h4><ul>
<li><p>项目创建</p>
<ul>
<li>导入thymeleaf、web-starter、lombok等</li>
</ul>
</li>
<li><p>添加静态资源放在static目录下面</p>
</li>
<li><p>已经写好的前端页面放在templates目录下面</p>
<ul>
<li>html文件记得加上 xmlns:th=”<a target="_blank" rel="noopener" href="http://www.thymeleaf.org&quot;/">http://www.thymeleaf.org&quot;</a></li>
<li>路径构建th:action=”@{/login}”</li>
<li>标签里面的写法：**[[${}]]**，比如[[${session.loginUser.userName}]]</li>
</ul>
</li>
<li><p>编写简单逻辑的登录controller</p>
</li>
<li><p>抽取公共页面，减少代码冗余</p>
<ul>
<li>编写公共页面，包括重复使用的页面，样式等</li>
<li>公共部分中有两种方式来标识<ul>
<li>th:fragment=”commonheader”    对应页面th:replace=”common :: <strong>commonheader</strong>“</li>
<li>直接使用id选择器    对应页面th:replace=”common :: <strong>#commonheader</strong>“</li>
</ul>
</li>
<li>调用公共部分三种方式<ul>
<li><code>th:insert</code> 是最简单的：它会简单地插入指定的片段作为其宿主标签的主体。</li>
<li><code>th:replace</code>实际上用指定的片段替换其主机标记。（推荐）</li>
<li><code>th:include</code>与 类似<code>th:insert</code>，但它不插入片段，而是仅插入此片段的<em>内容</em>。（3.0开始不推荐使用）</li>
<li><img src="/SpringBoot-2-02.assets/image-20210720183500471.png" alt="image-20210720183500471"><ul>
<li>注：在抽取公共页面时，不要改变原来部分或者样式的前后位置（比如最下面的js样式），可能会出错！！！</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>thymeleaf中表格的遍历</p>
<ul>
<li><p>先传入几个测试数据</p>
</li>
<li><p>```Java<br>List<User> users = Arrays.asList(new User(“zhangsan”, “123456”),</p>
<pre><code>    new User(&quot;lisi&quot;, &quot;123444&quot;),
    new User(&quot;haha&quot;, &quot;aaaaa&quot;),
    new User(&quot;hehe &quot;, &quot;aaddd&quot;));
</code></pre>
<p>model.addAttribute(“users”,users);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 遍历语法 th:each=&quot;user:$&#123;users&#125;，user里面有具体每个用户的数据</span><br><span class="line"></span><br><span class="line">- 可在user后面用逗号隔开，添加一个状态码，可以查看遍历的index,count等</span><br><span class="line"></span><br><span class="line">- ```html</span><br><span class="line">  &lt;tr class=&quot;gradeX&quot; th:each=&quot;user,status:$&#123;users&#125;&quot;&gt;</span><br><span class="line">      &lt;td th:text=&quot;$&#123;status.count&#125;&quot;&gt;Trident&lt;/td&gt;</span><br><span class="line">      &lt;td th:text=&quot;$&#123;user.userName&#125;&quot;&gt;Internet</span><br><span class="line">          Explorer 4.0&lt;/td&gt;</span><br><span class="line">      &lt;td th:text=&quot;$&#123;user.password&#125;&quot;&gt;Win 95+&lt;/td&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;/tr&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="2-8-拦截器"><a href="#2-8-拦截器" class="headerlink" title="2.8 拦截器"></a>2.8 拦截器</h3><h4 id="1-springboot中拦截器的使用"><a href="#1-springboot中拦截器的使用" class="headerlink" title="1. springboot中拦截器的使用"></a>1. springboot中拦截器的使用</h4><ul>
<li><p>实现HandlerInterceptor接口，这里主要是实现登录拦截</p>
</li>
<li><p>~~~java<br>/**</p>
<ul>
<li><p>登录检查</p>
</li>
<li><p>1、配置好拦截器要拦截哪些请求</p>
</li>
<li><p>2、把这些配置放在容器中</p>
</li>
<li><p>/<br>@Slf4j<br>public class LoginInterceptor implements HandlerInterceptor {<br>  /**</p>
<ul>
<li><p>目标方法执行之前</p>
</li>
<li><p>@param request</p>
</li>
<li><p>@param response</p>
</li>
<li><p>@param handler</p>
</li>
<li><p>@return</p>
</li>
<li><p>@throws Exception</p>
</li>
<li><p>/<br>@Override<br>public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {<br>  //利用Lombok提供的日志功能查看拦截了哪些路径<br>  String requestURI = request.getRequestURI();<br>  log.info(“preHandle拦截的请求路径是{}”,requestURI);</p>
<p>  //登陆检查<br>  HttpSession session = request.getSession();<br>  Object loginUser = session.getAttribute(“loginUser”);</p>
<p>  if (loginUser != null){</p>
<pre><code>  //放行
  return true;
</code></pre>
<p>  }else{</p>
<pre><code>  //拦截，跳转到登录页
  //这里不能用session，前端接收不到
  request.setAttribute(&quot;msg&quot;,&quot;请登录！&quot;);
  request.getRequestDispatcher(&quot;/&quot;).forward(request,response);
  return false;
</code></pre>
<p>  }<br>}</p>
</li>
</ul>
<p>  //目标方法执行之后<br>  @Override<br>  public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {</p>
<pre><code>  log.info(&quot;postHandle执行&#123;&#125;&quot;,modelAndView);
  HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);
</code></pre>
<p>  }</p>
<p>  //页面渲染之后<br>  @Override<br>  public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {</p>
<pre><code>  log.info(&quot;afterCompletion执行异常&#123;&#125;&quot;,ex);
  HandlerInterceptor.super.afterCompletion(request, response, handler, ex);
</code></pre>
<p>  }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 将拦截器注册到容器之中，并且指定拦截规则</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @Configuration</span><br><span class="line">  public class AdminWebConfig implements WebMvcConfigurer &#123;</span><br><span class="line">      @Override</span><br><span class="line">      public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">          registry.addInterceptor(new LoginInterceptor())</span><br><span class="line">                  .addPathPatterns(&quot;/**&quot;)  //拦截的路径,/**拦截所有路径，包括静态资源</span><br><span class="line">                  //放行的资源路径，不能直接写/static，找不到因为页面编写没有带static</span><br><span class="line">                  .excludePathPatterns(&quot;/&quot;,&quot;/login&quot;,&quot;/css/**&quot;,&quot;/fonts/**&quot;,&quot;/images/**&quot;,&quot;/js/**&quot;);</span><br><span class="line">  </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ```</span><br><span class="line"></span><br><span class="line">#### 2. 拦截器原理分析</span><br><span class="line"></span><br><span class="line">1、根据当前请求，找到**HandlerExecutionChain【**可以处理请求的handler以及handler的所有 拦截器】</span><br><span class="line"></span><br><span class="line">2、先来**顺序执行** 所有拦截器的 preHandle方法</span><br><span class="line"></span><br><span class="line">- 1、如果当前拦截器prehandler返回为true。则执行下一个拦截器的preHandle</span><br><span class="line">- 2、**如果当前拦截器返回为false。直接    倒序执行所有已经执行了的拦截器的  afterCompletion；**</span><br><span class="line"></span><br><span class="line">**3、如果任何一个拦截器返回false。直接跳出不执行目标方法**</span><br><span class="line"></span><br><span class="line">**4、所有拦截器都返回True。执行目标方法**</span><br><span class="line"></span><br><span class="line">**5、倒序执行所有拦截器的postHandle方法。**</span><br><span class="line"></span><br><span class="line">**6、前面的步骤有任何异常都会直接倒序触发** afterCompletion</span><br><span class="line"></span><br><span class="line">7、页面成功渲染完成以后，也会倒序触发 afterCompletion</span><br><span class="line"></span><br><span class="line">![image.png](SpringBoot-2-02.assets/1605765121071-64cfc649-4892-49a3-ac08-88b52fb4286f.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 2.9 文件上传</span><br><span class="line"></span><br><span class="line">#### 1. 文件上传的步骤</span><br><span class="line"></span><br><span class="line">- 页面中修改form表单</span><br><span class="line"></span><br><span class="line">- method=&quot;post&quot; th:action=&quot;@&#123;/upload&#125;&quot; enctype=&quot;multipart/form-data&quot;</span><br><span class="line"></span><br><span class="line">  - enctype=&quot;multipart/form-data&quot; ，multipart/form-data是指表单数据有多部分构成，既有文本数据，又有文件等二进制数据的意思，可提供文件上传功能</span><br><span class="line"></span><br><span class="line">- ```html</span><br><span class="line">  &lt;!--multiple代表上传多文件--&gt;</span><br><span class="line">  &lt;input type=&quot;file&quot; name=&quot;photos&quot; multiple&gt;</span><br><span class="line">  ```</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">- controller层通过 MultipartFile 自动封装上传过来的文件</span><br><span class="line"></span><br><span class="line">- @RequestPart</span><br><span class="line"></span><br><span class="line">  - 1 @RequestParam适用于name-value表单字段，而@RequestPart经常被用于处理复杂内容（例如JSON, XML） </span><br><span class="line">  - 2 当方法的参数类型不是String或者原生的MultipartFile / Part，@RequstParam需要注册并使用 Converter or PropertyEditor 进行类型转换，而 RequestPart 可通过请求体中的“Content-Type“进行使用 HttpMessageConverters转换</span><br><span class="line"></span><br><span class="line">- headImg.transferTo方法可将文件上传到指定路径</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @PostMapping(&quot;/upload&quot;)</span><br><span class="line">  public String upload(@RequestParam String email,</span><br><span class="line">                       @RequestParam String password,</span><br><span class="line">                       @RequestPart MultipartFile headImg,</span><br><span class="line">                       @RequestPart MultipartFile[] photos)throws IOException &#123;</span><br><span class="line">      log.info(&quot;上传的信息：email=&#123;&#125;，username=&#123;&#125;，headerImg=&#123;&#125;，photos=&#123;&#125;&quot;,</span><br><span class="line">              email,password,headImg.getSize(),photos.length);</span><br><span class="line">  </span><br><span class="line">      if(!headImg.isEmpty())&#123;</span><br><span class="line">          //保存到文件服务器，OSS服务器</span><br><span class="line">          String originalFilename = headImg.getOriginalFilename();</span><br><span class="line">          //需要抛出异常</span><br><span class="line">          headImg.transferTo(new File(&quot;D:\\test\\&quot;+originalFilename));</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      if(photos.length &gt; 0)&#123;</span><br><span class="line">          for (MultipartFile photo : photos) &#123;</span><br><span class="line">              if(!photo.isEmpty())&#123;</span><br><span class="line">                  String originalFilename = photo.getOriginalFilename();</span><br><span class="line">                  photo.transferTo(new File(&quot;D:\\test\\&quot;+originalFilename));</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      return &quot;main&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  ```</span><br><span class="line"></span><br><span class="line">#### 2. 文件上传原理分析</span><br><span class="line"></span><br><span class="line">**文件上传自动配置类-MultipartAutoConfiguration-**MultipartProperties</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 2.10 页面异常处理</span><br><span class="line"></span><br><span class="line">#### 1. 官网描述</span><br><span class="line"></span><br><span class="line">https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.spring-mvc.error-handling</span><br><span class="line"></span><br><span class="line">#### 2. 默认规则</span><br><span class="line"></span><br><span class="line">- 默认情况下，Spring Boot 提供了一个`/error`以合理方式处理所有错误的映射</span><br><span class="line"></span><br><span class="line">- 对于机器客户端，它会生成包含错误详细信息、HTTP 状态和异常消息的 JSON 响应</span><br><span class="line"></span><br><span class="line">- 对于浏览器客户端，有一个“whitelabel”错误视图，它以 HTML 格式呈现相同的数据（要自定义它，添加一个`View`解析为 的`error`）如下：![image.png](SpringBoot-2-02.assets/1606024616835-bc491bf0-c3b1-4ac3-b886-d4ff3c9874ce.png)</span><br><span class="line"></span><br><span class="line">- 可以将自定义的404.html，5xx.html页面放在下面目录下，当发生相应错误会自动解析</span><br><span class="line"></span><br><span class="line">  - 5xx代表5开头的所有错误</span><br><span class="line">  - 4xx代表4开头的所有错误</span><br><span class="line"></span><br><span class="line">  ```</span><br><span class="line">   resources/public/error/404.html</span><br><span class="line">   resources/templates/error/404.html</span><br><span class="line">  ```</span><br><span class="line"></span><br><span class="line">- 可以在页面中拿到下面的信息![image-20210721183513076](SpringBoot-2-02.assets/image-20210721183513076.png)</span><br><span class="line"></span><br><span class="line">#### 3. 异常处理自动配置原理</span><br><span class="line"></span><br><span class="line">- **ErrorMvcAutoConfiguration**</span><br><span class="line"></span><br><span class="line">  - **容器中的组件：类型：DefaultErrorAttributes -&gt;** **id：errorAttributes**</span><br><span class="line">    - **public class** **DefaultErrorAttributes** **implements** **ErrorAttributes**, **HandlerExceptionResolver**</span><br><span class="line">    - **DefaultErrorAttributes**：定义错误页面中可以包含哪些数据。</span><br><span class="line">  - **容器中的组件：类型：**BasicErrorController --&gt; id：basicErrorController（json+白页 适配响应）</span><br><span class="line">    - **处理默认** **/error 路径的请求；页面响应** **new** ModelAndView(**&quot;error&quot;**, model)；</span><br><span class="line">    - **容器中有组件 View**-&gt;**id是error**；（响应默认错误页）</span><br><span class="line">    - 容器中放组件 **BeanNameViewResolver（视图解析器）；按照返回的视图名作为组件的id去容器中找View对象。**</span><br><span class="line"></span><br><span class="line">  - **容器中的组件：**类型：**DefaultErrorViewResolver -&gt; id：**conventionErrorViewResolver</span><br><span class="line"></span><br><span class="line">    - 如果发生错误，会以HTTP的状态码 作为视图页地址（viewName），找到真正的页面</span><br><span class="line"></span><br><span class="line">    - error/404、5xx.html</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">#### 4. 定制错误处理逻辑</span><br><span class="line"></span><br><span class="line">1. 自定义错误页</span><br><span class="line"></span><br><span class="line">   - error/404.html   error/5xx.html；有精确的错误状态码页面就匹配精确，没有就找 4xx.html；如果都没有就触发白页</span><br><span class="line">   - 如果5xx.html，4xx.html这些页面本身有编码错误执行不了，会出现![image-20210722163501060](SpringBoot-2-02.assets/image-20210722163501060.png)</span><br><span class="line"></span><br><span class="line">2. @ControllerAdvice+@ExceptionHandler处理全局异常</span><br><span class="line"></span><br><span class="line">   - 底层是 **ExceptionHandlerExceptionResolver 支持的**</span><br><span class="line"></span><br><span class="line">   - ~~~java</span><br><span class="line">     /**</span><br><span class="line">      * 处理整个web controller的异常</span><br><span class="line">      * ArithmeticException数学异常，NullPointerException空指针异常</span><br><span class="line">      */</span><br><span class="line">     @Slf4j</span><br><span class="line">     @ControllerAdvice</span><br><span class="line">     public class GlobalExceptionHandler &#123;</span><br><span class="line">     </span><br><span class="line">         @ExceptionHandler(&#123;ArithmeticException.class,NullPointerException.class&#125;)  //处理异常</span><br><span class="line">         public String handleArithException(Exception e)&#123;</span><br><span class="line">     </span><br><span class="line">             log.error(&quot;异常是：&#123;&#125;&quot;,e);</span><br><span class="line">             return &quot;login&quot;; //视图地址</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ol start="3">
<li><p>@ResponseStatus+自定义异常 </p>
<ul>
<li><p>底层是 <strong>ResponseStatusExceptionResolver ，把responsestatus注解的信息底层调用</strong> <strong>response.sendError(statusCode, resolvedReason)；</strong></p>
</li>
<li><p><strong>tomcat发送的/error</strong></p>
</li>
<li><p>```java<br>/**</p>
<ul>
<li><p>自定义一个异常</p>
</li>
<li><p>/<br>@ResponseStatus(value= HttpStatus.FORBIDDEN,reason = “用户数量太多”)<br>public class UserTooManyException extends RuntimeException {</p>
<p>  //无参<br>  public  UserTooManyException(){</p>
<p>  }</p>
<p>  //有参<br>  public  UserTooManyException(String message){</p>
<pre><code>  super(message);
</code></pre>
<p>  }<br>}</p>
</li>
</ul>
<p>//自己抛出一个异常</p>
<pre><code>    if(users.size()&gt;3)&#123;
        throw new UserTooManyException();
    &#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. Spring底层的异常</span><br><span class="line"></span><br><span class="line">   - 如 参数类型转换异常；**DefaultHandlerExceptionResolver 处理框架底层的异常。**</span><br><span class="line">   - response.sendError(HttpServletResponse.**SC_BAD_REQUEST**, ex.getMessage()); </span><br><span class="line"></span><br><span class="line">5. 自定义实现 HandlerExceptionResolver 处理异常；可以作为默认的全局异常处理规则</span><br><span class="line"></span><br><span class="line">   - ```Java</span><br><span class="line">     @Order(value= Ordered.HIGHEST_PRECEDENCE)  //优先级，数字越小优先级越高</span><br><span class="line">     @Component</span><br><span class="line">     public class CustomerHandlerExceptionResolver implements HandlerExceptionResolver &#123;</span><br><span class="line">         @Override</span><br><span class="line">         public ModelAndView resolveException(HttpServletRequest request,</span><br><span class="line">                                              HttpServletResponse response,</span><br><span class="line">                                              Object handler, Exception ex) &#123;</span><br><span class="line">     </span><br><span class="line">             try &#123;</span><br><span class="line">                 response.sendError(511,&quot;我喜欢的错误&quot;);</span><br><span class="line">             &#125; catch (IOException e) &#123;</span><br><span class="line">                 e.printStackTrace();</span><br><span class="line">             &#125;</span><br><span class="line">             return new ModelAndView();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>提高了优先级，大部分页面出现异常都会被该自定义处理（404页面不行）</p>
</li>
</ul>
</li>
</ol>
<h3 id="2-11-web原生组件注入"><a href="#2-11-web原生组件注入" class="headerlink" title="2.11 web原生组件注入"></a>2.11 web原生组件注入</h3><h4 id="1-官方文档"><a href="#1-官方文档" class="headerlink" title="1. 官方文档"></a>1. 官方文档</h4><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.embedded-container.servlets-filters-listeners">https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.embedded-container.servlets-filters-listeners</a></li>
</ul>
<h4 id="2-使用Servlet-API（推荐使用）"><a href="#2-使用Servlet-API（推荐使用）" class="headerlink" title="2. 使用Servlet API（推荐使用）"></a>2. 使用Servlet API（推荐使用）</h4><ul>
<li><p>可以使用注解方式实现注入</p>
</li>
<li><p>使用之前需要在主程序加上注解，扫描指定包    @ServletComponentScan(basePackages = “com.wjj”)</p>
<ul>
<li><p>servlet组件 ，直接响应，不会经过拦截器 <strong>@WebServlet(urlPatterns = “/my”)</strong></p>
</li>
<li><p>```java<br>@WebServlet(urlPatterns = “/my”)<br>public class MyServlet extends HttpServlet {</p>
<pre><code>@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
    resp.getWriter().write(&quot;66&quot;);
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- filter组件，@WebFilter(urlPatterns = &quot;/css/*&quot;)</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @Slf4j</span><br><span class="line">  @WebFilter(urlPatterns = &quot;/css/*&quot;) //  /*是servlet中的写法，/**是spring中的写法</span><br><span class="line">  public class MyFilter implements Filter &#123;</span><br><span class="line">  </span><br><span class="line">      @Override</span><br><span class="line">      public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">          log.info(&quot;Filter初始化&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      @Override</span><br><span class="line">      public void destroy() &#123;</span><br><span class="line">          log.info(&quot;Filter销毁&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      @Override</span><br><span class="line">      public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line">          log.info(&quot;Filter工作&quot;);</span><br><span class="line">          filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>listener组件，@WebListener</p>
</li>
<li><p>```Java<br>@Slf4j<br>@WebListener<br>public class MyServletContextListener implements ServletContextListener {</p>
<pre><code>@Override
public void contextInitialized(ServletContextEvent sce) &#123;
    log.info(&quot;监听到项目初始化&quot;);
&#125;

@Override
public void contextDestroyed(ServletContextEvent sce) &#123;
    log.info(&quot;监听到项目销毁&quot;);
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- servlet不经过拦截器的原因：</span><br><span class="line"></span><br><span class="line">  - 容器中自动配置了  DispatcherServlet  属性绑定到 WebMvcProperties；对应的配置文件配置项是 **spring.mvc。**</span><br><span class="line">  - **通过** **ServletRegistrationBean**&lt;DispatcherServlet&gt; 把 DispatcherServlet  配置进来。</span><br><span class="line">  - 默认映射的是 / 路径</span><br><span class="line">  - 我们这里的servlet路径是/my，Tomcat-Servlet在多个servlet都能处理同一路径时，会采用精度优先的原则</span><br><span class="line">  - 因此就不会通过spring中设置的拦截器</span><br><span class="line"></span><br><span class="line">#### 2. 使用RegistrationBean方式</span><br><span class="line"></span><br><span class="line">- ServletRegistrationBean，FilterRegistrationBean以及ServletListenerRegistrationBean注入容器</span><br><span class="line"></span><br><span class="line">- ```Java</span><br><span class="line">  //(proxyBeanMethods = true) 保证组件依赖始终是单实例，默认就是true</span><br><span class="line">  @Configuration</span><br><span class="line">  public class MyRegistConfig &#123;</span><br><span class="line">  </span><br><span class="line">      @Bean</span><br><span class="line">      public ServletRegistrationBean myServlet()&#123;</span><br><span class="line">          MyServlet myServlet = new MyServlet();</span><br><span class="line">  </span><br><span class="line">          return new ServletRegistrationBean(myServlet,&quot;/my&quot;,&quot;/my02&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      @Bean</span><br><span class="line">      public FilterRegistrationBean myFilter()&#123;</span><br><span class="line">  </span><br><span class="line">          MyFilter myFilter = new MyFilter();</span><br><span class="line">  //        return new FilterRegistrationBean(myFilter,myServlet());  直接过滤myServlet()中的路径</span><br><span class="line">          FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean(myFilter);</span><br><span class="line">          filterRegistrationBean.setUrlPatterns(Arrays.asList(&quot;/my&quot;,&quot;/css/*&quot;));</span><br><span class="line">          return filterRegistrationBean;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      @Bean</span><br><span class="line">      public ServletListenerRegistrationBean myListener()&#123;</span><br><span class="line">          MyServletContextListener myServletContextListener = new MyServletContextListener();</span><br><span class="line">          return new ServletListenerRegistrationBean(myServletContextListener);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="2-12-嵌入式servlet容器"><a href="#2-12-嵌入式servlet容器" class="headerlink" title="2.12 嵌入式servlet容器"></a>2.12 嵌入式servlet容器</h3><h4 id="1-切换嵌入式Servlet容器"><a href="#1-切换嵌入式Servlet容器" class="headerlink" title="1. 切换嵌入式Servlet容器"></a>1. 切换嵌入式Servlet容器</h4><ul>
<li><p>嵌入式服务器就是指我们不需要额外再去部署服务器，springboot默认为我们提供了</p>
</li>
<li><p>默认支持的webServer<code>Tomcat</code>, <code>Jetty</code>, or <code>Undertow</code></p>
</li>
<li><p>web场景默认导入tomcat</p>
</li>
<li><p>切换方法 </p>
</li>
<li><p>~~~xml</p>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <exclusions>
        <!--移除默认tomcat-->
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
        </exclusion>
    </exclusions>
</dependency>
<!--添加新的-->
<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-jetty</artifactId>
        </dependency>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 原理</span><br><span class="line">  - SpringBoot应用启动发现当前是Web应用。web场景包-导入tomcat</span><br><span class="line">  - web应用会创建一个web版的ioc容器 `ServletWebServerApplicationContext` </span><br><span class="line">  - `ServletWebServerApplicationContext` 启动的时候寻找 `**ServletWebServerFactory**``（Servlet 的web服务器工厂---&gt; Servlet 的web服务器）` </span><br><span class="line">  - SpringBoot底层默认有很多的WebServer工厂；`TomcatServletWebServerFactory`, `JettyServletWebServerFactory`, or `UndertowServletWebServerFactory`</span><br><span class="line">  - `底层直接会有一个自动配置类。ServletWebServerFactoryAutoConfiguration`</span><br><span class="line">  - `ServletWebServerFactoryAutoConfiguration导入了ServletWebServerFactoryConfiguration（配置类）`</span><br><span class="line">  - `ServletWebServerFactoryConfiguration 配置类 根据动态判断系统中到底导入了那个Web服务器的包。（默认是web-starter导入tomcat包），容器中就有 TomcatServletWebServerFactory`</span><br><span class="line">  - `TomcatServletWebServerFactory 创建出Tomcat服务器并启动；TomcatWebServer 的构造器拥有初始化方法initialize---this.tomcat.start();`</span><br><span class="line">  - `内嵌服务器，就是手动把启动服务器的代码调用（tomcat核心jar包存在）`</span><br><span class="line"></span><br><span class="line">#### 2. 定制Servlet容器</span><br><span class="line"></span><br><span class="line">- 实现  **WebServerFactoryCu**stomizer&lt;ConfigurableServletWebServerFactory&gt; </span><br><span class="line"></span><br><span class="line">- 把配置文件的值和`**ServletWebServerFactory 进行绑定**`</span><br><span class="line"></span><br><span class="line">- 修改配置文件 **server.xxx**</span><br><span class="line">- 直接自定义 **ConfigurableServletWebServerFactory** </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**xxxxxCustomizer：定制化器，可以改变xxxx的默认规则**</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">import org.springframework.boot.web.server.WebServerFactoryCustomizer;</span><br><span class="line">import org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class CustomizationBean implements WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void customize(ConfigurableServletWebServerFactory server) &#123;</span><br><span class="line">        server.setPort(9000);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 2.13 定制化配置</span><br><span class="line"></span><br><span class="line">#### 1.定制化的主要方式</span><br><span class="line"></span><br><span class="line">1. **修改配置文件**</span><br><span class="line">   - 直接在application.properties或者application.yml文件中修改</span><br><span class="line">2. **xxxxxCustomizer：定制化器，可以改变xxxx的默认规则**</span><br><span class="line">3. **编写自定义的配置类   xxxConfiguration；+** **@Bean替换、增加容器中默认组件；视图解析器**</span><br><span class="line">4. **Web应用 编写一个配置类实现** **WebMvcConfigurer 即可定制化web功能；+ @Bean给容器中再扩展一些组件**（常用）</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Configuration</span><br><span class="line">public class AdminWebConfig implements WebMvcConfigurer</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">5. **@EnableWebMvc + WebMvcConfigurer —— @Bean** </span><br><span class="line"></span><br><span class="line">   - 添加@EnableWebMvc注解会使之前的所有规则失效，比如静态资源，欢迎页等。需要自己全面重新配置</span><br><span class="line"></span><br><span class="line">   - 原理</span><br><span class="line"></span><br><span class="line">     - 1、WebMvcAutoConfiguration  默认的SpringMVC的自动配置功能类。静态资源、欢迎页.....</span><br><span class="line">     - 2、一旦使用 @EnableWebMvc 、。会 @Import(DelegatingWebMvcConfiguration.**class**)</span><br><span class="line"></span><br><span class="line">     - 3、**DelegatingWebMvcConfiguration** 的 作用，只保证SpringMVC最基本的使用把所有系统中的WebMvcConfigurer 拿过来。所有功能的定制都是这些 WebMvcConfigurer  合起来一起生效自动配置了一些非常底层的组件。比如**RequestMappingHandlerMapping**、这些组件依赖的组件都是从容器中获取**public class** DelegatingWebMvcConfiguration **extends** **WebMvcConfigurationSupport**</span><br><span class="line"></span><br><span class="line">     - 4、**WebMvcAutoConfiguration** 里面的配置要能生效 必须  @ConditionalOnMissingBean(**WebMvcConfigurationSupport**.**class**)</span><br><span class="line">     - 5、@EnableWebMvc  导致了 **WebMvcAutoConfiguration  没有生效。**</span><br><span class="line"></span><br><span class="line">#### 2. 一般的原理分析套路</span><br><span class="line"></span><br><span class="line">**场景starter** **- xxxxAutoConfiguration - 导入xxx组件 - 绑定xxxProperties --** **绑定配置文件项** </span><br><span class="line"></span><br><span class="line">- 导入相应的场景</span><br><span class="line">- 找到对应的自动配置文件，命名主要是xxxxAutoConfiguration</span><br><span class="line">- 配置文件里面一般使用@bean导入各种组件</span><br><span class="line">- 组件里的默认属性都跟xxxProperties绑定</span><br><span class="line">- 最后绑定在配置文件之下，我们需要修改只需要改配置文件即可</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 3.数据访问</span><br><span class="line"></span><br><span class="line">### 3.1 SQL</span><br><span class="line"></span><br><span class="line">#### 1.数据源的自动配置</span><br><span class="line"></span><br><span class="line">- 导入场景依赖</span><br><span class="line"></span><br><span class="line">  ```xml</span><br><span class="line">  &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;/artifactId&gt;</span><br><span class="line">  &lt;/dependency&gt;</span><br><span class="line">  ```</span><br><span class="line"></span><br><span class="line">  &lt;img src=&quot;SpringBoot-2-02.assets/image-20210723165222136.png&quot; alt=&quot;image-20210723165222136&quot; style=&quot;zoom: 80%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">  - jdbc场景并没有导入驱动，因为无法判断实际使用的是哪个数据库</span><br><span class="line"></span><br><span class="line">  - 自行导入mysql</span><br><span class="line"></span><br><span class="line">    ~~~xml</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    1.导入之后默认会有一个8版本的</span><br><span class="line">    2.根据自己使用的mysql版本更改</span><br><span class="line">    	1、直接依赖引入具体版本（maven的就近依赖原则）</span><br><span class="line">    	2、重新声明版本（maven的属性的就近优先原则）</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">                &lt;mysql.version&gt;5.1.49&lt;/mysql.version&gt;</span><br><span class="line">            &lt;/properties&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>数据库和数据源</p>
<p>1.数据库中存放数据，数据源相当于连接到数据库的一条路径</p>
<p>2.DataSource 通常被称为数据源，它包含连接池和连接池管理两个部分，习惯上也经常把 DataSource 称为连接池。</p>
<p>3.数据库连接池就是准备一个池子，里面放着很多生成好的Connection，用户请求获得连接，就不需要getConnection,只要从池子里拿一个给他就行了，这样省掉了生成Connection的时间，效率上会有很大提高</p>
</blockquote>
</li>
<li><p>自动配置原理</p>
<ul>
<li><p>自动配置的类</p>
<ul>
<li>DataSourceAutoConfiguration ： 数据源的自动配置<ul>
<li>修改数据源相关的配置：<strong>spring.datasource</strong></li>
<li><strong>数据库连接池的配置，是自己容器中没有DataSource才自动配置的</strong></li>
<li>底层配置好的连接池是：<strong>HikariDataSource</strong></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Conditional(PooledDataSourceCondition.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,</span></span><br><span class="line"><span class="meta">		DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class,</span></span><br><span class="line"><span class="meta">		DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PooledDataSourceConfiguration</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>DataSourceTransactionManagerAutoConfiguration： 事务管理器的自动配置</li>
<li>JdbcTemplateAutoConfiguration： <strong>JdbcTemplate的自动配置，可以来对数据库进行crud</strong><ul>
<li>可以修改这个配置项@ConfigurationProperties(prefix = <strong>“spring.jdbc”</strong>) 来修改JdbcTemplate</li>
<li>@Bean@Primary    JdbcTemplate；容器中有这个组件</li>
</ul>
</li>
<li>JndiDataSourceAutoConfiguration： jndi的自动配置</li>
<li>XADataSourceAutoConfiguration： 分布式事务相关的</li>
</ul>
</li>
</ul>
</li>
<li><p>配置文件中修改配置</p>
<ul>
<li>```yaml<br>spring:<br>  datasource:<pre><code>url: jdbc:mysql://localhost:3306/student
username: root
password: 1234567
driver-class-name: com.mysql.jdbc.Driver
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 测试数据库</span><br><span class="line"></span><br><span class="line">  - ```Java</span><br><span class="line">    @Slf4j</span><br><span class="line">    @SpringBootTest</span><br><span class="line">    class Boot04WebAdminApplicationTests &#123;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">        @Test</span><br><span class="line">        void contextLoads() &#123;</span><br><span class="line">            </span><br><span class="line">    //        jdbcTemplate.queryForObject(&quot;select * from account_tbl&quot;)</span><br><span class="line">    //        jdbcTemplate.queryForList(&quot;select * from account_tbl&quot;,)</span><br><span class="line">            Long aLong = jdbcTemplate.queryForObject(&quot;select count(*) from admin&quot;, Long.class);</span><br><span class="line">            log.info(&quot;记录总数：&#123;&#125;&quot;,aLong);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="2-Druid数据源的使用"><a href="#2-Druid数据源的使用" class="headerlink" title="2. Druid数据源的使用"></a>2. Druid数据源的使用</h4><ul>
<li>druid官方github地址    <a target="_blank" rel="noopener" href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></li>
<li>使用Druid可以自定义使用，也可以starter</li>
</ul>
<ul>
<li><p>自定义方式</p>
<ul>
<li><p>先导入数据源依赖</p>
</li>
<li><p>```xml</p>
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.2.6</version>
</dependency>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 编写配置类</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @Configuration</span><br><span class="line">  public class MyDataSourceConfig &#123;</span><br><span class="line">  </span><br><span class="line">      // 默认的自动配置是判断容器中没有才会配@ConditionalOnMissingBean(DataSource.class)</span><br><span class="line">      //把我们数据源和配置文件spring.datasource里面的值进行绑定，不用再写用户名密码等信息</span><br><span class="line">      @ConfigurationProperties(&quot;spring.datasource&quot;)</span><br><span class="line">      @Bean</span><br><span class="line">      public DataSource dataSource() throws SQLException &#123;</span><br><span class="line">          DruidDataSource druidDataSource = new DruidDataSource();</span><br><span class="line">  </span><br><span class="line">  //        druidDataSource.setUrl();</span><br><span class="line">  //        druidDataSource.setUsername();</span><br><span class="line">  //        druidDataSource.setPassword();</span><br><span class="line">          //加入监控功能</span><br><span class="line">          druidDataSource.setFilters(&quot;stat,wall&quot;);</span><br><span class="line">  </span><br><span class="line">  //        druidDataSource.setMaxActive(10);</span><br><span class="line">          return druidDataSource;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      /**</span><br><span class="line">       * 配置 druid的监控页功能</span><br><span class="line">       * @return</span><br><span class="line">       */</span><br><span class="line">      @Bean</span><br><span class="line">      public ServletRegistrationBean statViewServlet()&#123;</span><br><span class="line">          StatViewServlet statViewServlet = new StatViewServlet();</span><br><span class="line">          ServletRegistrationBean&lt;StatViewServlet&gt; registrationBean = new ServletRegistrationBean&lt;&gt;(statViewServlet, &quot;/druid/*&quot;);</span><br><span class="line">  </span><br><span class="line">          registrationBean.addInitParameter(&quot;loginUsername&quot;,&quot;admin&quot;);</span><br><span class="line">          registrationBean.addInitParameter(&quot;loginPassword&quot;,&quot;123456&quot;);</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">          return registrationBean;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      /**</span><br><span class="line">       * WebStatFilter 用于采集web-jdbc关联监控的数据。</span><br><span class="line">       */</span><br><span class="line">      @Bean</span><br><span class="line">      public FilterRegistrationBean webStatFilter()&#123;</span><br><span class="line">          WebStatFilter webStatFilter = new WebStatFilter();</span><br><span class="line">  </span><br><span class="line">          FilterRegistrationBean&lt;WebStatFilter&gt; filterRegistrationBean = new FilterRegistrationBean&lt;&gt;(webStatFilter);</span><br><span class="line">          filterRegistrationBean.setUrlPatterns(Arrays.asList(&quot;/*&quot;));</span><br><span class="line">          filterRegistrationBean.addInitParameter(&quot;exclusions&quot;,&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;);</span><br><span class="line">  </span><br><span class="line">          return filterRegistrationBean;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>官方starter方式（推荐）</p>
<ul>
<li><p>官方文档：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
</li>
<li><p>配置项列表： <a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8">https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8</a></p>
</li>
<li><p>先引入starter依赖</p>
</li>
<li><p>```xml</p>
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid-spring-boot-starter</artifactId>
    <version>1.2.6</version>
</dependency>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 分析自动配置</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @Configuration</span><br><span class="line">  @ConditionalOnClass(&#123;DruidDataSource.class&#125;)</span><br><span class="line">  @AutoConfigureBefore(&#123;DataSourceAutoConfiguration.class&#125;)</span><br><span class="line">  @EnableConfigurationProperties(&#123;DruidStatProperties.class, DataSourceProperties.class&#125;)</span><br><span class="line">  @Import(&#123;DruidSpringAopConfiguration.class, DruidStatViewServletConfiguration.class, DruidWebStatFilterConfiguration.class, DruidFilterConfiguration.class&#125;)</span><br><span class="line">  </span><br><span class="line">  1.可在配置文件中配置 spring.datasource.druid</span><br><span class="line">  2.</span><br><span class="line">      DruidSpringAopConfiguration.class,   监控SpringBean的；配置项：spring.datasource.druid.aop-patterns</span><br><span class="line">  	DruidStatViewServletConfiguration.class, 监控页的配置：spring.datasource.druid.stat-view-servlet；默认开启</span><br><span class="line">   	DruidWebStatFilterConfiguration.class, web监控配置；spring.datasource.druid.web-stat-filter；默认开启</span><br><span class="line">      DruidFilterConfiguration.class&#125;) 所有Druid自己filter的配置</span><br></pre></td></tr></table></figure></li>
<li><p>配置示例</p>
</li>
<li><p>```yaml<br>spring:<br>  datasource:</p>
<pre><code>url: jdbc:mysql://localhost:3306/student?characterEncoding=utf-8&amp;useSSL=false
username: root
password: 1234567
driver-class-name: com.mysql.jdbc.Driver

#druid配置
druid:
  aop-patterns: com.wjj.boot.*  #监控SpringBean
  filters: stat,wall     # 底层开启功能，stat（sql监控），wall（防火墙）

  stat-view-servlet: # 配置监控页功能
    enabled: true
    login-username: admin
    login-password: 123
    resetEnable: false

  web-stat-filter: # 监控web
    enabled: true
    urlPattern: /*
    exclusions: &#39;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&#39;


  filter:
    stat: # 对上面filters里面的stat的详细配置
      slow-sql-millis: 1000
      logSlowSql: true
      enabled: true
    wall:
      enabled: true
      config:
        drop-table-allow: false
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 3. 整合Mybatis</span><br><span class="line"></span><br><span class="line">- 官方GitHub地址: https://github.com/mybatis/spring-boot-starter/</span><br><span class="line"></span><br><span class="line">- starter命名</span><br><span class="line"></span><br><span class="line">  - SpringBoot官方的Starter：spring-boot-starter-*</span><br><span class="line">  - 第三方的： *-spring-boot-starter</span><br><span class="line"></span><br><span class="line">- 导入mybatis-starter </span><br><span class="line"></span><br><span class="line">  - 注意版本,每个版本都有对应版本要求</span><br><span class="line"></span><br><span class="line">- ```xml</span><br><span class="line">  &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.2.0&lt;/version&gt;</span><br><span class="line">  &lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p> 直接SPRING INITIALIZR上勾选</p>
</li>
</ul>
<ol>
<li><p><strong>配置模式</strong></p>
<ul>
<li><p>导入mybatis-starter </p>
</li>
<li><p>编写mapper接口。标注**@Mapper注解**</p>
<ul>
<li>```Java<br>@Mapper<br>public interface AccountMapper {<pre><code>Account queryById(int id);
</code></pre>
}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 编写sql映射文件并绑定mapper接口</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;mapper namespace=&quot;com.wjj.boot.mapper.AccountMapper&quot;&gt;</span><br><span class="line">        &lt;select id=&quot;queryById&quot; resultType=&quot;com.wjj.boot.pojo.Account&quot;&gt;</span><br><span class="line">            select * from account where id = #&#123;id&#125;</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line">    &lt;/mapper&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>在application.yaml中指定Mapper配置文件的位置，以及指定全局配置文件的信息 </p>
<ul>
<li>```yaml<br>mybatis:<h1 id="config-location-classpath-mybatis-mybatisConfig-xml"><a href="#config-location-classpath-mybatis-mybatisConfig-xml" class="headerlink" title="config-location: classpath:mybatis/mybatisConfig.xml"></a>config-location: classpath:mybatis/mybatisConfig.xml</h1>  mapper-locations: classpath:mybatis/mapper/*.xml<br>  configuration:<pre><code>map-underscore-to-camel-case: true    #数据库写法转驼峰写法
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 可以在application.yaml指定mybatis配置文件的位置,在mybatis-config.xml里面写配置</span><br><span class="line"></span><br><span class="line">  - 也可以直接在application.yaml里面写配置,不通过mybatis-config.xml</span><br><span class="line"></span><br><span class="line">  - 两者有冲突,推荐后者</span><br><span class="line"></span><br><span class="line">- 编写service,自动装配mapper接口</span><br><span class="line"></span><br><span class="line">  - 实际中应该写service接口，再写一个serviceImpl实现类，此处简化</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    @Service</span><br><span class="line">    public class AccountService &#123;</span><br><span class="line">        @Autowired</span><br><span class="line">        AccountMapper accountMapper;</span><br><span class="line">    </span><br><span class="line">        public Account queryById(int id)&#123;</span><br><span class="line">            return accountMapper.queryById(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>controller代码测试</p>
<ul>
<li>```java<br>@Autowired<br>AccountService accountService;@ResponseBody<br>@GetMapping(“/query”)<br>public Account queryById(@RequestParam(“id”) int id){<pre><code>return accountService.queryById(id);
</code></pre>
}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">2. 注解模式</span><br><span class="line"></span><br><span class="line">   - 在配置模式中不用额外编写sql映射文件,直接在mapper接口上写注解即可</span><br><span class="line"></span><br><span class="line">   - ```Java</span><br><span class="line">     @Mapper</span><br><span class="line">     public interface CityMapper &#123;</span><br><span class="line">     </span><br><span class="line">         @Select(&quot;select * from city where id=#&#123;id&#125;&quot;)</span><br><span class="line">         public City queryCityById(int id);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>不适合复杂sql语句</li>
<li>增加耦合</li>
</ul>
</li>
</ul>
</li>
<li><p>混合模式</p>
<ul>
<li><p>实际上就是上面两种模式可以共存</p>
</li>
<li><p>SQL语句简单时可以使用注解,复杂时使用sql映射文件</p>
</li>
<li><p>```Java<br>@Mapper<br>public interface CityMapper {</p>
<pre><code>@Select(&quot;select * from city where id=#&#123;id&#125;&quot;)
public City queryCityById(int id);

public void insert(City city);
</code></pre>
<p>}</p>
<p>//sql映射文件<br>//useGeneratedKeys=”true” keyProperty=”id”    id自增<br>//@Options(useGeneratedKeys = true, keyProperty = “id”)注解方式的自增</p>
<mapper namespace="com.wjj.boot.mapper.CityMapper">
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into  city(`name`,`state`,`country`) values(#{name},#{state},#{country})
    </insert>
</mapper>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">   - 最佳实战方式</span><br><span class="line">   </span><br><span class="line">     - 引入mybatis-starter</span><br><span class="line">     - **配置application.yaml中，指定mapper-location位置即可**</span><br><span class="line">   - 编写Mapper接口并标注@Mapper注解</span><br><span class="line">     - 简单方法直接注解方式</span><br><span class="line">     - 复杂方法编写mapper.xml进行绑定映射</span><br><span class="line">   - 在主程序上使用*@MapperScan(&quot;com.atguigu.admin.mapper&quot;) 简化，其他的接口就可以不用标注@Mapper注解*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 4. 整合Mybatis-Plus</span><br><span class="line"></span><br><span class="line">1. 官方介绍：https://mp.baomidou.com/guide</span><br><span class="line"></span><br><span class="line">   gitee源码地址：https://gitee.com/baomidou/mybatis-plus</span><br><span class="line"></span><br><span class="line">2. 快速实现</span><br><span class="line"></span><br><span class="line">   - 导入依赖</span><br><span class="line"></span><br><span class="line">     - ~~~xml</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;3.4.3.1&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       ~~~</span><br><span class="line"></span><br><span class="line">   - 编写配置类，默认已经配置好了不少</span><br><span class="line"></span><br><span class="line">     - 注：使用mybatis-plus之后，原先配置的mybatis会失效，需要重新在mybatis-plus配置</span><br><span class="line">     </span><br><span class="line">   - 编写实体类</span><br><span class="line">   </span><br><span class="line">     - ```Java</span><br><span class="line">       //该注解可以表明该字段不在数据库，否则mybatis-plus使用报错</span><br><span class="line">       @TableField(exist = false)</span><br><span class="line">       private String userName;</span><br><span class="line">       @TableField(exist = false)</span><br><span class="line">       private String password;</span><br><span class="line">       </span><br><span class="line">       //@TableName(&quot;user_tbl&quot;),默认根据类名获取数据库中的表名，当名字不一致，可以使用该注解指定数据库表</span><br><span class="line">       //@TableName(&quot;user_tbl&quot;)注解加在类前面</span><br></pre></td></tr></table></figure></li>
<li><p>编写mapper类</p>
<ul>
<li>```java<br>public interface UserMapper extends BaseMapper<User> {}//BaseMapper里面包括了基本的CRUD方法，我们不用额外再写<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 测试输出</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    @Autowired</span><br><span class="line">        private UserMapper userMapper;</span><br><span class="line">    </span><br><span class="line">        @Test</span><br><span class="line">        public void testSelect() &#123;</span><br><span class="line">            System.out.println((&quot;----- selectAll method test ------&quot;));</span><br><span class="line">            List&lt;User&gt; userList = userMapper.selectList(null);</span><br><span class="line">            Assert.assertEquals(5, userList.size());</span><br><span class="line">            userList.forEach(System.out::println);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>具体可参照官方文档</p>
</li>
</ul>
</li>
<li><p>CRUD功能的实现</p>
<ul>
<li><p>在上一部分的基础上进行</p>
</li>
<li><p>service层 Userservice 继承IService<User></p>
<ul>
<li>```java<br>public interface UserService extends IService<User> {<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 实现service接口</span><br><span class="line"></span><br><span class="line">  - ```Java</span><br><span class="line">    @Service</span><br><span class="line">    public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements UserService &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>控制层实现数据的展示和数据删除</p>
<ul>
<li><p>RedirectAttributes重定向之后可以携带参数</p>
</li>
<li><p>```Java</p>
<pre><code>@GetMapping(&quot;/user/delete/&#123;id&#125;&quot;)
public String deleteUser(@PathVariable(&quot;id&quot;) Integer id,
                         @RequestParam(&quot;pn&quot;) Integer pn,
                         RedirectAttributes rn)&#123;

    userService.removeById(id);
    rn.addAttribute(pn);
    return &quot;redirect:/dynamic_table&quot;;
&#125;

@GetMapping(&quot;/dynamic_table&quot;)
public String dynamic_table(@RequestParam(value = &quot;pn&quot;,defaultValue = &quot;1&quot;) Integer pn, Model model)&#123;
    
    List&lt;User&gt; list = userService.list();
</code></pre>
<p>//        model.addAttribute(“list”,list);</p>
<pre><code>    //分页查询数据
    Page&lt;User&gt; page = new Page&lt;&gt;(pn,2);

    //分页查询结果
    Page&lt;User&gt; userPage = userService.page(page, null);
    model.addAttribute(&quot;page&quot;,userPage);
    return &quot;data_tables/dynamic_table&quot;;
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- html页面</span><br><span class="line"></span><br><span class="line">  - 传入page，page.records表示总分页数据</span><br><span class="line"></span><br><span class="line">  - 遍历加状态写法：th:each=&quot;user,status:$&#123;page.records&#125;&quot;，user表示每个遍历出来的用户，status表示状态</span><br><span class="line"></span><br><span class="line">  - 页面转发并携带参数写法：th:href=&quot;@&#123;/dynamic_table(pn=$&#123;num&#125;)&#125;&quot; th:href=&quot;@&#123;/user/delete/&#123;id&#125;(id=$&#123;user.id&#125;,pn=$&#123;page.current&#125;)&#125;</span><br><span class="line"></span><br><span class="line">  - 条件判断：th:if  th:switch</span><br><span class="line"></span><br><span class="line">  - 生成数字序列：#numbers.sequence(1,page.pages)，从一到末页</span><br><span class="line"></span><br><span class="line">  - ```html</span><br><span class="line">    &lt;thead&gt;</span><br><span class="line">                    &lt;th&gt;#&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;编号&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;用户名&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;年龄&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;邮箱&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line">    </span><br><span class="line">                &lt;/thead&gt;</span><br><span class="line">                &lt;tbody&gt;</span><br><span class="line">                    &lt;tr class=&quot;gradeX&quot; th:each=&quot;user,status:$&#123;page.records&#125;&quot;&gt;</span><br><span class="line">                        &lt;td th:text=&quot;$&#123;status.count&#125;&quot;&gt;Trident&lt;/td&gt;</span><br><span class="line">                        &lt;td th:text=&quot;$&#123;user.id&#125;&quot;&gt;Internet&lt;/td&gt;</span><br><span class="line">                        &lt;td th:text=&quot;$&#123;user.name&#125;&quot;&gt;Internet</span><br><span class="line">                            Explorer 4.0&lt;/td&gt;</span><br><span class="line">                        &lt;td th:text=&quot;$&#123;user.age&#125;&quot;&gt;Win 95+&lt;/td&gt;</span><br><span class="line">                        &lt;td th:text=&quot;$&#123;user.email&#125;&quot;&gt;Win 95+&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;</span><br><span class="line">                            &lt;a th:href=&quot;@&#123;/user/delete/&#123;id&#125;(id=$&#123;user.id&#125;,pn=$&#123;page.current&#125;)&#125;&quot; class=&quot;btn btn-danger btn-sm&quot; type=&quot;button&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">                        &lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/tbody&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">            &lt;!--分页条--&gt;</span><br><span class="line">                &lt;div class=&quot;row-fluid&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;span6&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;dataTables_info&quot; id=&quot;dynamic-table_info&quot;&gt;</span><br><span class="line">                            当前第[[$&#123;page.current&#125;]]页  总计 [[$&#123;page.pages&#125;]]页  共[[$&#123;page.total&#125;]]条记录</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;span6&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;dataTables_paginate paging_bootstrap pagination&quot;&gt;</span><br><span class="line">                            &lt;ul&gt;    </span><br><span class="line">                                &lt;!--判断是否有上一页--&gt;</span><br><span class="line">                                &lt;li th:switch=&quot;$&#123;page.hasPrevious()&#125;&quot;&gt;</span><br><span class="line">                                    &lt;a th:href=&quot;@&#123;/dynamic_table(pn=$&#123;page.getCurrent()-1&#125;)&#125;&quot; th:case=&quot;true&quot;&gt;← 前一页&lt;/a&gt;</span><br><span class="line">                                    &lt;a th:href=&quot;@&#123;/dynamic_table(pn=$&#123;page.getCurrent()&#125;)&#125;&quot; th:case=&quot;false&quot;&gt;← 前一页&lt;/a&gt;</span><br><span class="line">                                &lt;/li&gt;</span><br><span class="line">                                &lt;li th:class=&quot;$&#123;num == page.current?&#x27;active&#x27;:&#x27;&#x27;&#125;&quot; th:each=&quot;num:$&#123;#numbers.sequence(1,page.pages)&#125;&quot; &gt;</span><br><span class="line">                                    &lt;a th:href=&quot;@&#123;/dynamic_table(pn=$&#123;num&#125;)&#125;&quot;&gt;[[$&#123;num&#125;]]&lt;/a&gt;</span><br><span class="line">                                &lt;/li&gt;</span><br><span class="line">                                &lt;!--判断是否还有下一页--&gt;</span><br><span class="line">                                &lt;li th:switch=&quot;$&#123;page.hasNext()&#125;&quot;&gt;</span><br><span class="line">                                    &lt;a th:href=&quot;@&#123;/dynamic_table(pn=$&#123;page.getCurrent()+1&#125;)&#125;&quot; th:case=&quot;true&quot;&gt;下一页 → &lt;/a&gt;</span><br><span class="line">                                    &lt;a th:href=&quot;@&#123;/dynamic_table(pn=$&#123;page.getCurrent()&#125;)&#125;&quot; th:case=&quot;false&quot;&gt;下一页 → &lt;/a&gt;</span><br><span class="line">                                &lt;/li&gt;</span><br><span class="line">                            &lt;/ul&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="3-2-NOSQL"><a href="#3-2-NOSQL" class="headerlink" title="3.2 NOSQL"></a>3.2 NOSQL</h3><ul>
<li>NOSQL是指非关系型数据库</li>
<li>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。</li>
</ul>
<h2 id="4-单元测试"><a href="#4-单元测试" class="headerlink" title="4.单元测试"></a>4.单元测试</h2><h3 id="4-1-Junit5的基本介绍"><a href="#4-1-Junit5的基本介绍" class="headerlink" title="4.1. Junit5的基本介绍"></a>4.1. Junit5的基本介绍</h3><ul>
<li><p>Spring Boot 2.2.0 版本开始引入 JUnit 5 作为单元测试默认库</p>
</li>
<li><p>作为最新版本的JUnit框架，JUnit5与之前版本的Junit框架有很大的不同。由三个不同子项目的几个不同模块组成。</p>
<ul>
<li><strong>JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage</strong></li>
<li><strong>JUnit Platform</strong>: Junit Platform是在JVM上启动测试框架的基础，不仅支持Junit自制的测试引擎，其他测试引擎也都可以接入。</li>
<li><strong>JUnit Jupiter</strong>: JUnit Jupiter提供了JUnit5的新的编程模型，是JUnit5新特性的核心。内部 包含了一个<strong>测试引擎</strong>，用于在Junit Platform上运行。</li>
<li><strong>JUnit Vintage</strong>: 由于JUint已经发展多年，为了照顾老的项目，JUnit Vintage提供了兼容JUnit4.x,Junit3.x的测试引擎。</li>
</ul>
</li>
<li><p>注意：</p>
<p><strong>SpringBoot 2.4 以上版本移除了默认对</strong> <strong>Vintage 的依赖。如果需要兼容junit4需要自行引入（不能使用junit4的功能 @Test****）</strong></p>
<p><strong>JUnit 5’s Vintage Engine Removed from</strong> <code>**spring-boot-starter-test,如果需要继续兼容junit4需要自行引入vintage**</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hamcrest<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hamcrest-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p>SpringBoot整合Junit5之后，项目创建就会自动生成一个测试类</p>
</li>
<li><p>编写新的测试只需要加上@Test注解（注意区分不同版本的@Test，需要Junit5的）</p>
</li>
<li><p>Junit类中包括Spring的功能，比如</p>
<ul>
<li>@Autowired 自动装配</li>
<li>@Transactional 标注测试方法，测试完成后自动回滚</li>
</ul>
</li>
<li><p>测试完成之后，可进行汇总报告，查看有多少断言异常，多少跳过</p>
<ul>
<li>断言一般都是产生异常错误</li>
<li>跳过包括前置条件和@Disabled </li>
</ul>
<p><img src="/SpringBoot-2-02.assets/image-20210727180518664.png" alt="image-20210727180518664"></p>
</li>
</ul>
<h3 id="4-2-Juint5常用注解"><a href="#4-2-Juint5常用注解" class="headerlink" title="4.2 Juint5常用注解"></a>4.2 Juint5常用注解</h3><ul>
<li>官方文档：<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations</a></li>
</ul>
<ul>
<li><p>**@Test :**表示方法是测试方法。但是与JUnit4的@Test不同，他的职责非常单一不能声明任何属性，拓展的测试将会由Jupiter提供额外测试</p>
<ul>
<li>@Test测试执行的顺序跟方法名有关</li>
</ul>
</li>
<li><p>**@ParameterizedTest :**表示方法是参数化测试，下方会有详细介绍</p>
</li>
<li><p>**@RepeatedTest :**表示方法可重复执行，@RepeatedTest(5)</p>
</li>
<li><p>**@DisplayName :**为测试类或者测试方法设置展示名称</p>
</li>
<li><p><strong>@BeforeEach :<strong>表示在</strong>每个单元测试之前</strong>执行</p>
</li>
<li><p><strong>@AfterEach :<strong>表示在</strong>每个单元测试之后</strong>执行</p>
</li>
<li><p><strong>@BeforeAll :<strong>表示在</strong>所有</strong>单元测试之前执行，<strong>必须是static</strong></p>
</li>
<li><p><strong>@AfterAll :<strong>表示在</strong>所有</strong>单元测试之后执行，<strong>必须是static</strong></p>
</li>
<li><p>**@Tag :**表示单元测试类别，类似于JUnit4中的@Categories</p>
</li>
<li><p>**@Disabled :**表示测试类或测试方法不执行，类似于JUnit4中的@Ignore</p>
</li>
<li><p>**@Timeout :**表示测试方法运行如果超过了指定时间将会返回错误</p>
</li>
<li><p>**@ExtendWith :**为测试类或测试方法提供扩展类引用</p>
<ul>
<li><p>@SpringBoot注解中就有</p>
</li>
<li><p>```java<br>/**</p>
<ul>
<li>@BootstrapWith(SpringBootTestContextBootstrapper.class)</li>
<li>@ExtendWith(SpringExtension.class)</li>
<li>/<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```java</span><br><span class="line">import org.junit.jupiter.api.Test; //注意这里使用的是jupiter的Test注解！！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class TestDemo &#123;</span><br><span class="line"></span><br><span class="line">  @Test</span><br><span class="line">  @DisplayName(&quot;第一次测试&quot;)</span><br><span class="line">  public void firstTest() &#123;</span><br><span class="line">      System.out.println(&quot;hello world&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">    /**</span><br><span class="line">     * 规定方法超时时间。超出时间测试出异常</span><br><span class="line">     *</span><br><span class="line">     * @throws InterruptedException</span><br><span class="line">     */</span><br><span class="line">    @Timeout(value = 500, unit = TimeUnit.MILLISECONDS)</span><br><span class="line">    @Test</span><br><span class="line">    void testTimeout() throws InterruptedException &#123;</span><br><span class="line">        //只要超时就抛出异常</span><br><span class="line">        Thread.sleep(600);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @BeforeEach</span><br><span class="line">    public void testBeforeEach()&#123;</span><br><span class="line">        System.out.println(&quot;每个测试前&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterEach</span><br><span class="line">    public void testAfterEach()&#123;</span><br><span class="line">        System.out.println(&quot;每个测试后&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @BeforeAll</span><br><span class="line">    static void testBeforeAll() &#123;</span><br><span class="line">        System.out.println(&quot;所有测试就要开始了...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterAll</span><br><span class="line">    static void testAfterAll() &#123;</span><br><span class="line">        System.out.println(&quot;所有测试以及结束了...&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-3-断言机制"><a href="#4-3-断言机制" class="headerlink" title="4.3 断言机制"></a>4.3 断言机制</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-assertions">https://junit.org/junit5/docs/current/user-guide/#writing-tests-assertions</a></p>
<ul>
<li><p>*<em>这些断言方法都是 org.junit.jupiter.api.Assertions .<em>的静态方法</em></em></p>
</li>
<li></li>
</ul>
<h4 id="1-简单断言"><a href="#1-简单断言" class="headerlink" title="1. 简单断言"></a>1. 简单断言</h4><ul>
<li><p>对单个值进行简单的判断</p>
</li>
<li><p>当断言执行之后，测试不会继续往下走</p>
</li>
<li><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>assertEquals</td>
<td>判断两个对象或两个原始类型是否相等</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>判断两个对象或两个原始类型是否不相等</td>
</tr>
<tr>
<td>assertSame</td>
<td>判断两个对象引用是否指向同一个对象</td>
</tr>
<tr>
<td>assertNotSame</td>
<td>判断两个对象引用是否指向不同的对象</td>
</tr>
<tr>
<td>assertTrue</td>
<td>判断给定的布尔值是否为 true</td>
</tr>
<tr>
<td>assertFalse</td>
<td>判断给定的布尔值是否为 false</td>
</tr>
<tr>
<td>assertNull</td>
<td>判断给定的对象引用是否为 null</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>判断给定的对象引用是否不为 null</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;simple assertion&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">simple</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="comment">//前面的值时期盼值，后面的是实际值，最后面是自定义信息</span></span><br><span class="line">     assertEquals(<span class="number">3</span>, <span class="number">1</span> + <span class="number">2</span>, <span class="string">&quot;simple math&quot;</span>);</span><br><span class="line">     assertNotEquals(<span class="number">3</span>, <span class="number">1</span> + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">     assertNotSame(<span class="keyword">new</span> Object(), <span class="keyword">new</span> Object());</span><br><span class="line">     Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">     assertSame(obj, obj);</span><br><span class="line"></span><br><span class="line">     assertFalse(<span class="number">1</span> &gt; <span class="number">2</span>);</span><br><span class="line">     assertTrue(<span class="number">1</span> &lt; <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">     assertNull(<span class="keyword">null</span>);</span><br><span class="line">     assertNotNull(<span class="keyword">new</span> Object());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-数组断言"><a href="#2-数组断言" class="headerlink" title="2. 数组断言"></a>2. 数组断言</h4><ul>
<li>通过 assertArrayEquals 方法来判断两个对象或原始类型的数组是否相等</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;array assertion&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">array</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> assertArrayEquals(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">1</span>, <span class="number">2</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-组合断言"><a href="#3-组合断言" class="headerlink" title="3. 组合断言"></a>3. 组合断言</h4><ul>
<li><p>所有断言全部需要生效</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;assert all&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">all</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertAll(<span class="string">&quot;Math&quot;</span>,</span><br><span class="line">              () -&gt; assertEquals(<span class="number">2</span>, <span class="number">1</span> + <span class="number">1</span>),</span><br><span class="line">              () -&gt; assertTrue(<span class="number">1</span> &gt; <span class="number">0</span>)</span><br><span class="line">             );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-异常断言"><a href="#4-异常断言" class="headerlink" title="4. 异常断言"></a>4. 异常断言</h4><ul>
<li>JUnit5提供了一种新的断言方式<strong>Assertions.assertThrows()</strong> ,配合函数式编程就可以进行使用。</li>
<li>业务逻辑异常则不抛出异常，反之业务逻辑正常抛出异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;异常测试&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThrows(</span><br><span class="line">           <span class="comment">//扔出断言异常</span></span><br><span class="line">            ArithmeticException.class, () -&gt; System.out.println(<span class="number">1</span> % <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="5-超时断言"><a href="#5-超时断言" class="headerlink" title="5. 超时断言"></a>5. 超时断言</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;超时测试&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">timeoutTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//Duration持续时间</span></span><br><span class="line">    assertTimeout(Duration.ofMillis(<span class="number">1000</span>), () -&gt; Thread.sleep(<span class="number">500</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6-快速失败"><a href="#6-快速失败" class="headerlink" title="6. 快速失败"></a>6. 快速失败</h4><p>通过 fail 方法直接使得测试失败</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;fail&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shouldFail</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> fail(<span class="string">&quot;This should fail&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-4-前置条件（assumptions）"><a href="#4-4-前置条件（assumptions）" class="headerlink" title="4.4 前置条件（assumptions）"></a>4.4 前置条件（assumptions）</h3><ul>
<li><p>前置条件和断言机制类似</p>
</li>
<li><p>不同之处在于<strong>不满足的断言会使得测试方法失败</strong>，而不满足的<strong>前置条件只会使得测试方法的执行终止</strong>。前置条件可以看成是测试方法执行的前提，当该前提不满足时，就没有继续执行的必要。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;前置条件&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AssumptionsTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    assumeTrue(<span class="keyword">true</span>);</span><br><span class="line">    assumingThat(<span class="keyword">true</span>,() -&gt; System.out.println(<span class="string">&quot;成功&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>assumeTrue 和 assumFalse 确保给定的条件为 true 或 false，不满足条件会使得测试执行终止。assumingThat 的参数是表示条件的布尔值和对应的 Executable 接口的实现对象。只有条件满足时，Executable 对象才会被执行；当条件不满足时，测试执行并不会终止。</p>
</li>
</ul>
<h3 id="4-5-嵌套测试"><a href="#4-5-嵌套测试" class="headerlink" title="4.5 嵌套测试"></a>4.5 嵌套测试</h3><ul>
<li><p>JUnit 5 可以通过 Java 中的内部类和@Nested 注解实现嵌套测试</p>
</li>
<li><p>嵌套外面的测试调用不了里面的@BeforeEach等，内层的可以调用外面的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;A stack&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestingAStackDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//栈</span></span><br><span class="line">    Stack&lt;Object&gt; stack;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;is instantiated with new Stack()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">isInstantiatedWithNew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;when new&quot;)</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WhenNew</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@BeforeEach</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">createNewStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;is empty&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            assertTrue(stack.isEmpty());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when popped&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">throwsExceptionWhenPopped</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::pop);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when peeked&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">throwsExceptionWhenPeeked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::peek);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Nested</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;after pushing an element&quot;)</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">AfterPushing</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            String anElement = <span class="string">&quot;an element&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@BeforeEach</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">pushAnElement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                stack.push(anElement);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;it is no longer empty&quot;)</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">isNotEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when popped and is empty&quot;)</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">returnElementWhenPopped</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                assertEquals(anElement, stack.pop());</span><br><span class="line">                assertTrue(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when peeked but remains not empty&quot;)</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">returnElementWhenPeeked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                assertEquals(anElement, stack.peek());</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-6-参数化测试"><a href="#4-6-参数化测试" class="headerlink" title="4.6 参数化测试"></a>4.6 参数化测试</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests">https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests</a></p>
<p>利用**@ValueSource**等注解，指定入参，我们将可以使用不同的参数进行多次单元测试，而不需要每新增一个参数就新增一个单元测试，省去了很多冗余代码。</p>
<p><strong>@ValueSource</strong>: 为参数化测试指定入参来源，支持八大基础类以及String类型,Class类型</p>
<p><strong>@NullSource</strong>: 表示为参数化测试提供一个null的入参</p>
<p><strong>@EnumSource</strong>: 表示为参数化测试提供一个枚举入参</p>
<p><strong>@CsvFileSource</strong>：表示读取指定CSV文件内容作为参数化测试入参</p>
<p><strong>@MethodSource</strong>：表示读取指定方法的返回值作为参数化测试入参(注意方法返回需要是一个流)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;参数化测试&quot;)</span></span><br><span class="line"><span class="meta">@ValueSource(strings = &#123; &quot;racecar&quot;, &quot;radar&quot;, &quot;able was I ere I saw elba&quot; &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">palindromes</span><span class="params">(String candidate)</span> </span>&#123;</span><br><span class="line">    System.out.println(candidate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-7-迁移注意"><a href="#4-7-迁移注意" class="headerlink" title="4.7 迁移注意"></a>4.7 迁移注意</h3><p>官方文档内容：</p>
<p>以下是在将现有 JUnit 4 测试迁移到 JUnit Jupiter 时应该注意的主题。</p>
<ul>
<li>Annotations 驻留在<code>org.junit.jupiter.api</code>包中。</li>
<li>Assertions 驻留在<code>org.junit.jupiter.api.Assertions</code>.<ul>
<li>请注意，您可以继续使用来自<code>org.junit.Assert</code>或任何其他断言库（例如<a target="_blank" rel="noopener" href="https://joel-costigliola.github.io/assertj/">AssertJ</a>、<a target="_blank" rel="noopener" href="https://hamcrest.org/JavaHamcrest/">Hamcrest</a>、<a target="_blank" rel="noopener" href="https://truth.dev/">Truth</a>等）的断言方法。</li>
</ul>
</li>
<li>Assumptions 存在于<code>org.junit.jupiter.api.Assumptions</code>.<ul>
<li>请注意，JUnit Jupiter 5.4 和更高版本支持来自 JUnit 4 <code>org.junit.Assume</code>类的假设方法。具体来说，JUnit Jupiter 支持 JUnit 4<code>AssumptionViolatedException</code>发出信号，表明应该中止测试而不是将其标记为失败。</li>
</ul>
</li>
<li><code>@Before</code>和<code>@After</code>不再存在；使用<code>@BeforeEach</code>和<code>@AfterEach</code>代替。</li>
<li><code>@BeforeClass</code>和<code>@AfterClass</code>不再存在；使用<code>@BeforeAll</code>和<code>@AfterAll</code> 代替。</li>
<li><code>@Ignore</code>不再存在：使用<code>@Disabled</code>或其他内置一个 <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-conditional-execution">执行条件</a>，而不是<ul>
<li>另请参阅<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#migrating-from-junit4-ignore-annotation-support">JUnit 4 @Ignore 支持</a>。</li>
</ul>
</li>
<li><code>@Category</code>不复存在; 使用<code>@Tag</code>来代替。</li>
<li><code>@RunWith</code>不复存在; 由 <code>@ExtendWith</code>取代</li>
<li><code>@Rule</code>和<code>@ClassRule</code>不再存在；被<code>@ExtendWith</code>和 <code>@RegisterExtension</code>取代</li>
</ul>
<h2 id="5-指标监控"><a href="#5-指标监控" class="headerlink" title="5.指标监控"></a>5.指标监控</h2><h3 id="5-1-SpringBoot-Actuator"><a href="#5-1-SpringBoot-Actuator" class="headerlink" title="5.1 SpringBoot Actuator"></a>5.1 SpringBoot Actuator</h3><ol>
<li><p>简介</p>
<p>未来每一个微服务在云上部署以后，我们都需要对其进行监控、追踪、审计、控制等。</p>
<p>SpringBoot就抽取了Actuator场景，使得我们每个微服务快速引用即可获得生产级别的应用监控、审计等功能。</p>
</li>
<li><p>1.x 和 2.x 的不同</p>
<p><img src="/SpringBoot-2-02.assets/1606884394162-ac7f2d8e-7abb-44df-9998-fb0f2705f238.png" alt="image.png"></p>
</li>
</ol>
<ol start="3">
<li><p>简单使用</p>
<ol>
<li><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--指标监控--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>访问 <a target="_blank" rel="noopener" href="http://localhost:8080/actuator/">http://localhost:8080/actuator/</a></p>
<p>访问 <a target="_blank" rel="noopener" href="http://localhost:8080/actuator/+%E5%85%B7%E4%BD%93%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8D%B3%E5%8F%AF">http://localhost:8080/actuator/+具体的端口即可</a></p>
<p><img src="/SpringBoot-2-02.assets/image-20210728123104731.png" alt="image-20210728123104731"></p>
</li>
<li><p>端点</p>
<ul>
<li><p>官方文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints">https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints</a></p>
</li>
<li><p>Actuator 端点可让您监控应用程序并与之交互。</p>
</li>
<li><p>Spring Boot 包含许多内置端点，并允许您添加自己的端点。例如，<code>health</code>端点提供基本的应用程序健康信息。</p>
</li>
<li><p>默认情况下，除<code>shutdown</code>之外的所有端点都是启动的</p>
</li>
<li><p>暴露端点，有JMX形式和web形式</p>
<ul>
<li><p>默认是否暴露，参见官方文档</p>
</li>
<li><p>JMX形式指</p>
<p><img src="/SpringBoot-2-02.assets/image-20210728154004054.png" alt="image-20210728154004054"></p>
</li>
<li><p>暴露所有形式为web</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">enabled-by-default:</span> <span class="literal">true</span> <span class="comment">#启用所有端点信息</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span>  <span class="comment">#以web方式暴露</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="5-2-常用端口"><a href="#5-2-常用端口" class="headerlink" title="5.2 常用端口"></a>5.2 常用端口</h3><ol>
<li><p>Health Endpoint</p>
<ul>
<li><p>健康检查端点，我们一般用于在云平台，平台会定时的检查应用的健康状况，我们就需要Health Endpoint可以为平台返回当前应用的一系列组件健康状况的集合。</p>
</li>
<li><p>health endpoint返回的结果，应该是一系列健康检查后的一个汇总报告</p>
</li>
<li><p>很多的健康检查默认已经自动配置好了，比如：数据库、redis等</p>
</li>
<li><p>可以很容易的添加自定义的健康检查机制</p>
</li>
<li><p>默认只有status可以自行打开</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span> <span class="comment">#配置单个端点</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span> <span class="comment">#默认never</span></span><br></pre></td></tr></table></figure>

<p><img src="/SpringBoot-2-02.assets/image-20210728160953697.png" alt="image-20210728160953697"></p>
</li>
</ul>
</li>
<li><p>Metrics Endpoint</p>
<ul>
<li><p>提供详细的、层级的、空间指标信息，这些信息可以被pull（主动推送）或者push（被动获取）方式得到；</p>
<ul>
<li><p>通过Metrics对接多种监控系统</p>
</li>
<li><p>简化核心Metrics开发</p>
</li>
<li><p>添加自定义Metrics或者扩展已有Metrics</p>
</li>
</ul>
</li>
<li><p>可以进一步访问，比如：<a target="_blank" rel="noopener" href="http://localhost:8080/actuator/metrics/jvm.memory.max">http://localhost:8080/actuator/metrics/jvm.memory.max</a></p>
</li>
</ul>
<p><img src="/SpringBoot-2-02.assets/image-20210728161146945.png" alt="image-20210728161146945"></p>
</li>
</ol>
<h3 id="5-3-定制端口"><a href="#5-3-定制端口" class="headerlink" title="5.3 定制端口"></a>5.3 定制端口</h3><h4 id="1-定制Health信息"><a href="#1-定制Health信息" class="headerlink" title="1. 定制Health信息"></a>1. 定制Health信息</h4><ol>
<li><p>实现HealthIndicator接口</p>
</li>
<li><p>通过继承AbstractHealthIndicator类，最终命名为MyComHealthIndicator前缀MyCom</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComHealthIndicator</span> <span class="keyword">extends</span> <span class="title">AbstractHealthIndicator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 真实的检查方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> builder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doHealthCheck</span><span class="params">(Health.Builder builder)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//mongodb。  获取连接进行测试</span></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// 检查完成</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span> == <span class="number">2</span>)&#123;</span><br><span class="line"><span class="comment">//            builder.up(); //健康</span></span><br><span class="line">            builder.status(Status.UP);</span><br><span class="line">            map.put(<span class="string">&quot;count&quot;</span>,<span class="number">1</span>);</span><br><span class="line">            map.put(<span class="string">&quot;ms&quot;</span>,<span class="number">100</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//            builder.down();</span></span><br><span class="line">            builder.status(Status.OUT_OF_SERVICE);</span><br><span class="line">            map.put(<span class="string">&quot;err&quot;</span>,<span class="string">&quot;连接超时&quot;</span>);</span><br><span class="line">            map.put(<span class="string">&quot;ms&quot;</span>,<span class="number">3000</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        builder.withDetail(<span class="string">&quot;code&quot;</span>,<span class="number">100</span>)</span><br><span class="line">                .withDetails(map);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/SpringBoot-2-02.assets/image-20210728165426782.png" alt="image-20210728165426782"></p>
</li>
</ol>
<h4 id="2-定制info信息"><a href="#2-定制info信息" class="headerlink" title="2. 定制info信息"></a>2. 定制info信息</h4><ol>
<li><p>编写配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">appName:</span> <span class="string">boot-admin</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2.0</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">mavenProjectName:</span> <span class="string">@project.artifactId@</span>  <span class="comment">#使用@@可以获取maven的pom文件值</span></span><br><span class="line">  <span class="attr">mavenProjectVersion:</span> <span class="string">@project.version@</span></span><br></pre></td></tr></table></figure></li>
<li><p>编写InfoContributor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.info.Info;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.info.InfoContributor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleInfoContributor</span> <span class="keyword">implements</span> <span class="title">InfoContributor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contribute</span><span class="params">(Info.Builder builder)</span> </span>&#123;</span><br><span class="line">        builder.withDetail(<span class="string">&quot;example&quot;</span>,</span><br><span class="line">                Collections.singletonMap(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/SpringBoot-2-02.assets/image-20210728170239632.png" alt="image-20210728170239632"></p>
</li>
</ol>
<h4 id="3-定制Metrics信息"><a href="#3-定制Metrics信息" class="headerlink" title="3. 定制Metrics信息"></a>3. 定制Metrics信息</h4><p>增加定制Metrics</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyService</span></span>&#123;</span><br><span class="line">    Counter counter;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">(MeterRegistry meterRegistry)</span></span>&#123;</span><br><span class="line">         counter = meterRegistry.counter(<span class="string">&quot;myservice.method.running.counter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        counter.increment();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//也可以使用下面的方式</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">MeterBinder <span class="title">queueSize</span><span class="params">(Queue queue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (registry) -&gt; Gauge.builder(<span class="string">&quot;queueSize&quot;</span>, queue::size).register(registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-定制端口"><a href="#4-定制端口" class="headerlink" title="4. 定制端口"></a>4. 定制端口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Endpoint(id = &quot;myService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServiceEndpoint</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ReadOperation</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">getDockerInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//端点的读操作 http://localhost:8080/actuator/myService</span></span><br><span class="line">        <span class="keyword">return</span> Collections.singletonMap(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;docker started...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WriteOperation</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">restartDocker</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;docker restarted....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-4-实现可视化"><a href="#5-4-实现可视化" class="headerlink" title="5.4 实现可视化"></a>5.4 实现可视化</h3><p>官方GitHub：<a target="_blank" rel="noopener" href="https://github.com/codecentric/spring-boot-admin">https://github.com/codecentric/spring-boot-admin</a></p>
<p>快速开始：     <a target="_blank" rel="noopener" href="https://codecentric.github.io/spring-boot-admin/2.3.1/#getting-started">https://codecentric.github.io/spring-boot-admin/2.3.1/#getting-started</a></p>
<ul>
<li><p>创建一个项目专门用来监控</p>
<ul>
<li><p>该项目导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>给主程序加上注解 @EnableAdminServer，同时设置不同的端口号方便区分</p>
</li>
</ul>
</li>
<li><p>给需要监控的项目配置</p>
<ul>
<li><p>```xml</p>
<dependency>
    <groupId>de.codecentric</groupId>
    <artifactId>spring-boot-admin-starter-client</artifactId>
    <version>2.3.1</version>
</dependency>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 配置文件指向用于监控的项目，同时改变uri和应用名，保证监控在线</span><br><span class="line"></span><br><span class="line">  ```yaml</span><br><span class="line">  boot:</span><br><span class="line">    admin:</span><br><span class="line">      client:</span><br><span class="line">        url: http://localhost:8888/ #指向用于监控的端口</span><br><span class="line">        instance:</span><br><span class="line">          prefer-ip: true #改为使用server.address，默认hostname</span><br><span class="line">  application:</span><br><span class="line">    name: admin #改变应用名，默认名spring-boot-application</span><br></pre></td></tr></table></figure></li>
<li><p>注：程序的health必须是up，负责也会导致离线</p>
</li>
</ul>
</li>
</ul>
<h2 id="6-原理解析"><a href="#6-原理解析" class="headerlink" title="6.原理解析"></a>6.原理解析</h2><h3 id="6-1-Profiles功能"><a href="#6-1-Profiles功能" class="headerlink" title="6.1 Profiles功能"></a>6.1 Profiles功能</h3><ul>
<li>该功能主要是为了便于存在不同生产环境时，可以方便快速的切换</li>
</ul>
<h4 id="1-application-profile功能"><a href="#1-application-profile功能" class="headerlink" title="1 . application-profile功能"></a>1 . application-profile功能</h4><ul>
<li><p>在配置文件中可以对生产环境进行切换，命名通常为application-xxx.yaml</p>
</li>
<li><p>```yaml<br>#指定激活的生产环境，两个配置文件都会生效，出现同名优先profiles<br>spring.profiles.active=test </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 默认的application.yaml默认都会生效</span><br><span class="line"></span><br><span class="line">- 激活指定环境</span><br><span class="line"></span><br><span class="line">  - 使用上述配置文件指定</span><br><span class="line">  - 使用命令行进行激活：</span><br><span class="line">    - java -jar xxx.jar --spring.profiles.active=prod  --person.name=haha</span><br><span class="line">    - 同样可以在命令行中修改配置文件的指定值，**命令行优先级最高**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 2. @Profile条件装配功能</span><br><span class="line"></span><br><span class="line">- 当有多个类都与配置进行绑定</span><br><span class="line"></span><br><span class="line">- 可使用@Profile(&quot;xxx&quot;)注解，不同类绑定不同的环境</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @Profile(value = &#123;&quot;prod&quot;,&quot;default&quot;&#125;)</span><br><span class="line">  @Component</span><br><span class="line">  @ConfigurationProperties(&quot;person&quot;)</span><br><span class="line">  @Data</span><br><span class="line">  public class Boss implements Person &#123;</span><br><span class="line">  </span><br><span class="line">      private String name;</span><br><span class="line">      private Integer age;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-profile分组"><a href="#3-profile分组" class="headerlink" title="3. profile分组"></a>3. profile分组</h4><ul>
<li><p>可以通过分组同时加载多个环境</p>
</li>
<li><pre><code class="properties">spring.profiles.group.production[0]=proddb
spring.profiles.group.production[1]=prodmq

使用：--spring.profiles.active=production  激活
</code></pre>
</li>
</ul>
<h3 id="6-2-外部化配置"><a href="#6-2-外部化配置" class="headerlink" title="6.2 外部化配置"></a>6.2 外部化配置</h3><ul>
<li><p>官方文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config">https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config</a></p>
</li>
<li><p>可以在不同环境中使用相同的应用程序代码。可以使用各种外部配置源，包括 Java 属性文件、YAML 文件、环境变量和命令行参数。</p>
</li>
<li><p>Spring Boot 使用一个非常特殊的<code>PropertySource</code>顺序，旨在允许合理地覆盖值。属性按以下顺序考虑（较低项目的值覆盖较早的项目）：</p>
<ol>
<li>默认属性（由设置指定<code>SpringApplication.setDefaultProperties</code>）。</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.9/javadoc-api/org/springframework/context/annotation/PropertySource.html"><code>@PropertySource</code></a>你的<code>@Configuration</code>类的注释。请注意，<code>Environment</code>在刷新应用程序上下文之前，不会将此类属性源添加到。现在配置某些属性（例如在刷新开始之前读取的<code>logging.*</code>和）为时已晚<code>spring.main.*</code>。</li>
<li>配置数据（如<code>application.properties</code>文件）</li>
<li>一<code>RandomValuePropertySource</code>，只有在拥有性能<code>random.*</code>。</li>
<li>操作系统环境变量。</li>
<li>Java 系统属性 ( <code>System.getProperties()</code>)。</li>
<li>JNDI 属性来自<code>java:comp/env</code>.</li>
<li><code>ServletContext</code> 初始化参数。</li>
<li><code>ServletConfig</code> 初始化参数。</li>
<li>来自<code>SPRING_APPLICATION_JSON</code>（嵌入在环境变量或系统属性中的内联 JSON）的属性。</li>
<li>命令行参数。</li>
<li><code>properties</code>属性在您的测试中。可<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing.spring-boot-applications.autoconfigured-tests">用于测试应用程序的特定部分</a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.3/api/org/springframework/boot/test/context/SpringBootTest.html"><code>@SpringBootTest</code></a>的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing.spring-boot-applications.autoconfigured-tests">测试注释</a>。</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.9/javadoc-api/org/springframework/test/context/TestPropertySource.html"><code>@TestPropertySource</code></a> 测试中的注释。</li>
<li><code>$HOME/.config/spring-boot</code>当 devtools 处于活动状态时，目录中的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.devtools.globalsettings">Devtools 全局设置属性</a>。</li>
</ol>
</li>
</ul>
<ol>
<li><p>配置数据文件可以从下面获取</p>
<p>(1) classpath 根路径</p>
<p>(2) classpath 根路径下config目录</p>
<p>(3) jar包当前目录</p>
<p>(4) jar包当前目录的config目录</p>
<p>(5) /config子目录的直接子目录</p>
<p>下面的配置会覆盖上面的</p>
</li>
<li><p>配置文件加载顺序</p>
<ol>
<li>当前jar包内部的application.properties和application.yml</li>
<li>当前jar包内部的application-{profile}.properties 和 application-{profile}.yml</li>
<li>引用的外部jar包的application.properties和application.yml</li>
<li>引用的外部jar包的application-{profile}.properties 和 application-{profile}.yml</li>
</ol>
</li>
<li><p>指定环境优先，外部优先，后面的可以覆盖前面的同名配置项</p>
</li>
</ol>
<h3 id="6-3-自定义starter"><a href="#6-3-自定义starter" class="headerlink" title="6.3 自定义starter"></a>6.3 自定义starter</h3><ol>
<li><p>starter的原理</p>
<ul>
<li><p>starter的pom引入autoconfigurer </p>
</li>
<li><p>autoconfigure包中配置使用 <strong>META-INF/spring.factories</strong> 中 <strong>EnableAutoConfiguration 的值，使得项目启动加载指定的自动配置类</strong></p>
</li>
<li><p><strong>编写自动配置类 xxxAutoConfiguration -&gt; xxxxProperties</strong></p>
<ul>
<li><strong>@Configuration</strong></li>
<li><strong>@Conditional</strong></li>
<li><strong>@EnableConfigurationProperties</strong></li>
<li><strong>@Bean</strong></li>
</ul>
</li>
<li><p>……</p>
</li>
</ul>
<p><strong>引入starter</strong> <strong>— xxxAutoConfiguration — 容器中放入组件 —- 绑定xxxProperties —-</strong> <strong>配置项</strong></p>
</li>
<li><p>自定义starter</p>
<ol>
<li><p>创建一个atguigu-hello-spring-boot-starter（启动器）</p>
<p>再创建一个atguigu-hello-spring-boot-starter-autoconfigure（自动配置包）</p>
</li>
<li><p>启动器里面只需要导入自动配置包中的依赖</p>
</li>
<li><p>自动配置包里面写业务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 默认不要放在容器中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix() + <span class="string">&quot;：&quot;</span> + userName + <span class="string">&quot;》&quot;</span> + helloProperties.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再写一个HelloProperties</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;wjj.hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPrefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrefix</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSuffix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuffix</span><span class="params">(String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写HelloServiceAutoConfiguration</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloProperties.class)</span>  <span class="comment">//默认HelloProperties放在容器中</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServiceAutoConfiguration</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(HelloService.class)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">helloService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HelloService helloService = <span class="keyword">new</span> HelloService();</span><br><span class="line">        <span class="keyword">return</span> helloService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写<strong>spring.factories</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">com.wjj.hello.auto.HelloServiceAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>打包到本地仓库即可使用</p>
<ul>
<li>先打包自动配置包，再打包启动器</li>
<li>打包clean+install</li>
</ul>
</li>
<li><p>使用自定义starter</p>
<ul>
<li><p>导入相关starter依赖</p>
</li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.helloProperties.getPrefix() + <span class="string">&quot;：&quot;</span> + userName + <span class="string">&quot;》&quot;</span> + <span class="keyword">this</span>.helloProperties.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置文件可以写相关内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wjj.hello.prefix = 好好学习</span><br><span class="line">wjj.hello.suffix = 人</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="6-4-SpringBoot原理"><a href="#6-4-SpringBoot原理" class="headerlink" title="6.4 SpringBoot原理"></a>6.4 SpringBoot原理</h3>
    </div>

    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      
    </div>


    
    
    
        <div class="reward-container">
  <div>您的支持将成为我创作的动力！</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Jie 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Jie 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Jie
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://example.com/article/a25851fc.html" title="springboot学习笔记2">http://example.com/article/a25851fc.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/springboot/" rel="tag"># springboot</a>
              <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag"># 学习笔记</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/article/17173e24.html" rel="prev" title="SpringBoot学习笔记1">
      <i class="fa fa-chevron-left"></i> SpringBoot学习笔记1
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">1.配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-properties"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-yaml"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 yaml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E9%85%8D%E7%BD%AE%E6%8F%90%E7%A4%BA"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.3 配置提示</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Web%E5%BC%80%E5%8F%91"><span class="nav-number">1.2.</span> <span class="nav-text">2.Web开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-SpringMvc-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 SpringMvc 自动配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E7%AE%80%E5%8D%95%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 简单功能分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">1. 静态资源的访问</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Webjars"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">2. Webjars</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%AC%A2%E8%BF%8E%E9%A1%B5%E4%B8%8E%E5%B0%8F%E5%9B%BE%E6%A0%87"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">3. 欢迎页与小图标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">4. 静态资源源码分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3 请求参数处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Rest%E9%A3%8E%E6%A0%BC"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">1. Rest风格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">2. 请求映射原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%B8%B8%E7%94%A8%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">3. 常用的注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Servlet-API"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">4. Servlet API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0"><span class="nav-number">1.2.3.5.</span> <span class="nav-text">5. 复杂参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-pojo%E5%B0%81%E8%A3%85"><span class="nav-number">1.2.3.6.</span> <span class="nav-text">6. pojo封装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94"><span class="nav-number">1.2.4.</span> <span class="nav-text">2.4 数据响应</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%93%8D%E5%BA%94JSON%E6%95%B0%E6%8D%AE"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">1. 响应JSON数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-springmvc%E6%94%AF%E6%8C%81%E5%93%8D%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">2. springmvc支持响应的数据类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="nav-number">1.2.5.</span> <span class="nav-text">2.5 内容协商</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90"><span class="nav-number">1.2.6.</span> <span class="nav-text">2.6 视图解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-Thymeleaf"><span class="nav-number">1.2.7.</span> <span class="nav-text">2.7 模板引擎-Thymeleaf</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.2.7.1.</span> <span class="nav-text">1. 介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">1.2.7.2.</span> <span class="nav-text">2. 基本使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%BB%83%E4%B9%A0"><span class="nav-number">1.2.7.3.</span> <span class="nav-text">3. 后台管理系统练习</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-number">1.2.8.</span> <span class="nav-text">2.8 拦截器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-springboot%E4%B8%AD%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.2.8.1.</span> <span class="nav-text">1. springboot中拦截器的使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-11-web%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%85%A5"><span class="nav-number">1.2.9.</span> <span class="nav-text">2.11 web原生组件注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="nav-number">1.2.9.1.</span> <span class="nav-text">1. 官方文档</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8Servlet-API%EF%BC%88%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="nav-number">1.2.9.2.</span> <span class="nav-text">2. 使用Servlet API（推荐使用）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-12-%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E5%AE%B9%E5%99%A8"><span class="nav-number">1.2.10.</span> <span class="nav-text">2.12 嵌入式servlet容器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%88%87%E6%8D%A2%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="nav-number">1.2.10.1.</span> <span class="nav-text">1. 切换嵌入式Servlet容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Druid%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.2.10.2.</span> <span class="nav-text">2. Druid数据源的使用</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#config-location-classpath-mybatis-mybatisConfig-xml"><span class="nav-number">2.</span> <span class="nav-text">config-location: classpath:mybatis&#x2F;mybatisConfig.xml</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-NOSQL"><span class="nav-number">2.0.1.</span> <span class="nav-text">3.2 NOSQL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="nav-number">2.1.</span> <span class="nav-text">4.单元测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Junit5%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.1.1.</span> <span class="nav-text">4.1. Junit5的基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Juint5%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="nav-number">2.1.2.</span> <span class="nav-text">4.2 Juint5常用注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E6%96%AD%E8%A8%80%E6%9C%BA%E5%88%B6"><span class="nav-number">2.1.3.</span> <span class="nav-text">4.3 断言机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%AE%80%E5%8D%95%E6%96%AD%E8%A8%80"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">1. 简单断言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%95%B0%E7%BB%84%E6%96%AD%E8%A8%80"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">2. 数组断言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%BB%84%E5%90%88%E6%96%AD%E8%A8%80"><span class="nav-number">2.1.3.3.</span> <span class="nav-text">3. 组合断言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%BC%82%E5%B8%B8%E6%96%AD%E8%A8%80"><span class="nav-number">2.1.3.4.</span> <span class="nav-text">4. 异常断言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E8%B6%85%E6%97%B6%E6%96%AD%E8%A8%80"><span class="nav-number">2.1.3.5.</span> <span class="nav-text">5. 超时断言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5"><span class="nav-number">2.1.3.6.</span> <span class="nav-text">6. 快速失败</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%EF%BC%88assumptions%EF%BC%89"><span class="nav-number">2.1.4.</span> <span class="nav-text">4.4 前置条件（assumptions）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95"><span class="nav-number">2.1.5.</span> <span class="nav-text">4.5 嵌套测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="nav-number">2.1.6.</span> <span class="nav-text">4.6 参数化测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-%E8%BF%81%E7%A7%BB%E6%B3%A8%E6%84%8F"><span class="nav-number">2.1.7.</span> <span class="nav-text">4.7 迁移注意</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="nav-number">2.2.</span> <span class="nav-text">5.指标监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-SpringBoot-Actuator"><span class="nav-number">2.2.1.</span> <span class="nav-text">5.1 SpringBoot Actuator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3"><span class="nav-number">2.2.2.</span> <span class="nav-text">5.2 常用端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E5%AE%9A%E5%88%B6%E7%AB%AF%E5%8F%A3"><span class="nav-number">2.2.3.</span> <span class="nav-text">5.3 定制端口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AE%9A%E5%88%B6Health%E4%BF%A1%E6%81%AF"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">1. 定制Health信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AE%9A%E5%88%B6info%E4%BF%A1%E6%81%AF"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">2. 定制info信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%AE%9A%E5%88%B6Metrics%E4%BF%A1%E6%81%AF"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">3. 定制Metrics信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%AE%9A%E5%88%B6%E7%AB%AF%E5%8F%A3"><span class="nav-number">2.2.3.4.</span> <span class="nav-text">4. 定制端口</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-%E5%AE%9E%E7%8E%B0%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">2.2.4.</span> <span class="nav-text">5.4 实现可视化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="nav-number">2.3.</span> <span class="nav-text">6.原理解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-Profiles%E5%8A%9F%E8%83%BD"><span class="nav-number">2.3.1.</span> <span class="nav-text">6.1 Profiles功能</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-application-profile%E5%8A%9F%E8%83%BD"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">1 . application-profile功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-profile%E5%88%86%E7%BB%84"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">3. profile分组</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E5%A4%96%E9%83%A8%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="nav-number">2.3.2.</span> <span class="nav-text">6.2 外部化配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-%E8%87%AA%E5%AE%9A%E4%B9%89starter"><span class="nav-number">2.3.3.</span> <span class="nav-text">6.3 自定义starter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-SpringBoot%E5%8E%9F%E7%90%86"><span class="nav-number">2.3.4.</span> <span class="nav-text">6.4 SpringBoot原理</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jie"
      src="/images/author.jpg">
  <p class="site-author-name" itemprop="name">Jie</p>
  <div class="site-description" itemprop="description">以后这样的事还多着呢</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
       
         <a href="https://github.com/a-cipher" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;a-cipher" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
       
      </span>
      <span class="links-of-author-item">
       
         <a href="mailto:a-cipher@foxmail.com" title="E-Mail → mailto:a-cipher@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
       
      </span>
      <span class="links-of-author-item">
       
         <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
       
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jie</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">114k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:43</span>
</div>

<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("08/01/2021 00:00:00");//此处修改你的建站时间或者网站上线时间 
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '74ASTAjyuQCIN3sUmF6NB914-gzGzoHsz',
      appKey     : '4LvGCRjICuhdKF9qaO2jYOxM',
      placeholder: "尽情说说你的想法！",
      avatar     : 'wavatar',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":"true#是否在手机端显示"},"log":false});</script></body>
</html>
